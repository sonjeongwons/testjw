ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•˜ì—¬ ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì„±ëŠ¥, ì˜ˆì™¸ ì²˜ë¦¬, ì¤‘ë³µ ì½”ë“œ ì œê±° ì¸¡ë©´ì—ì„œ ê°œì„ í•˜ê² ìŠµë‹ˆë‹¤.
ê° ë©”ì†Œë“œë³„ë¡œ ì–´ë–¤ ì ì„ ë³€ê²½í–ˆëŠ”ì§€, ì™œ ê°œì„ ì´ í•„ìš”í•œì§€, ë” ë‚˜ì€ ì„¤ê³„ë¥¼ ìœ„í•´ ì–´ë–¤ ê°œë…ì„ ì ìš©í–ˆëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

âœ… ê°œì„ ëœ ì½”ë“œ
ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•˜ë©´ì„œ ì¤‘ë³µ ì œê±°, ì±…ì„ ë¶„ë¦¬, ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

java
ë³µì‚¬
í¸ì§‘
package com.scf.manager.mvc.service;

import com.nimbusds.jose.JOSEException;
import com.nimbusds.jose.JWSAlgorithm;
import com.nimbusds.jose.JWSHeader;
import com.nimbusds.jose.JWSSigner;
import com.nimbusds.jose.crypto.RSASSASigner;
import com.nimbusds.jose.jwk.RSAKey;
import com.nimbusds.jwt.JWTClaimsSet;
import com.nimbusds.jwt.SignedJWT;
import com.scf.manager.common.enums.TypeEnums;
import com.scf.manager.common.exception.ResourceNotFoundException;
import com.scf.manager.common.util.UrlUtil;
import com.scf.manager.mvc.domain.Function;
import com.scf.manager.mvc.domain.FunctionEnvironment;
import com.scf.manager.mvc.dto.FunctionDTO;
import com.scf.manager.mvc.dto.FunctionEnvironmentDTO;
import com.scf.manager.mvc.dto.TokenDTO;
import com.scf.manager.mvc.dto.UrlDTO;
import com.scf.manager.mvc.repository.FunctionEnvironmentRepository;
import com.scf.manager.mvc.repository.FunctionRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.builder.CompareToBuilder;
import org.springframework.transaction.annotation.Transactional;

import java.io.IOException;
import java.text.ParseException;
import java.util.*;
import java.util.concurrent.atomic.AtomicInteger;
import java.util.regex.Pattern;
import java.util.stream.Collectors;

@Slf4j
@org.springframework.stereotype.Service
@RequiredArgsConstructor
public class FunctionEnvironmentService {
    private static final long YEAR_SIZE_100 = 60L * 1000 * 60 * 24 * 365 * 100;
    private static final int MAX_ENV_COUNT = 50;
    private static final int MIN_MEMORY_VALUE = 128;
    private static final int MAX_KEY_LENGTH = 50;
    private static final int MAX_VALUE_LENGTH = 50;

    private static final Set<String> VALID_BOOLEAN_VALUES = Set.of("Y", "N");
    private static final Set<String> VALID_PROTOCOLS = Set.of("http", "https");
    private static final Set<String> VALID_LIMIT_KEYS = Set.of("minute", "second");

    private final FunctionRepository functionRepository;
    private final FunctionEnvironmentRepository functionEnvironmentRepository;
    private final FunctionService functionService;
    private final KnativeService knativeService;

    @Transactional
    public FunctionDTO.Response registerFunctionToken(String functionKey) throws ParseException, JOSEException {
        Function function = functionRepository.findByFunctionKey(functionKey)
                .orElseThrow(() -> new ResourceNotFoundException("í‘ì…˜í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

        RSAKey rsaJWK = RSAKey.parse(functionService.registerJWK(new TokenDTO.Register(function, function.getFunctionKey())));

        SignedJWT signedJWT = createSignedJWT(
                new JWTClaimsSet.Builder()
                        .subject(function.getName())
                        .issuer("https://scp.com")
                        .expirationTime(new Date(System.currentTimeMillis() + YEAR_SIZE_100))
                        .build(),
                rsaJWK
        );

        function.updateToken(signedJWT.serialize());
        return function.toDto();
    }

    private SignedJWT createSignedJWT(JWTClaimsSet claimsSet, RSAKey rsaJWK) throws JOSEException {
        SignedJWT signedJWT = new SignedJWT(
                new JWSHeader.Builder(JWSAlgorithm.RS256).keyID(rsaJWK.getKeyID()).build(),
                claimsSet
        );
        signedJWT.sign(new RSASSASigner(rsaJWK));
        return signedJWT;
    }

    public FunctionEnvironmentDTO.Response registerFunctionEnvironment(FunctionEnvironmentDTO.Register reqDto, Function function, AtomicInteger envCountChecker) {
        validateEnvironment(reqDto, envCountChecker);
        reqDto.setFunctionSeq(function.getFunctionSeq());
        return functionEnvironmentRepository.save(FunctionEnvironment.register(reqDto)).toDto();
    }

    private static void validateEnvironment(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
        switch (reqDto.getType()) {
            case "token":
                validateToken(reqDto);
                break;
            case "url":
                validateUrl(reqDto);
                break;
            case "limit":
                validateLimit(reqDto);
                break;
            case "memory":
                validateMemory(reqDto);
                break;
            case "env":
                validateEnv(reqDto, envCountChecker);
                break;
            case "coldStartYn":
                validateColdStart(reqDto);
                break;
            default:
                throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì…ë‹ˆë‹¤.");
        }
    }

    private static void validateToken(FunctionEnvironmentDTO.Register reqDto) {
        if (!VALID_BOOLEAN_VALUES.contains(reqDto.getValue())) {
            throw new IllegalArgumentException("í† í°ì‚¬ìš©ì—¬ë¶€ ê°’ì€ Y ë˜ëŠ” Nì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
        }
        if ("Y".equals(reqDto.getValue()) && StringUtils.isEmpty(reqDto.getKey())) {
            throw new IllegalArgumentException("í† í° ê°’ì´ Yì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        }
        if ("N".equals(reqDto.getValue()) && StringUtils.isNotEmpty(reqDto.getKey())) {
            throw new IllegalArgumentException("í† í° ê°’ì´ Nì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    private static void validateUrl(FunctionEnvironmentDTO.Register reqDto) {
        if (!VALID_PROTOCOLS.contains(reqDto.getKey())) {
            throw new IllegalArgumentException("URL í‚¤ì˜ í—ˆìš© ê°’ì€ http ë˜ëŠ” https ì…ë‹ˆë‹¤.");
        }
        if (StringUtils.isEmpty(reqDto.getValue())) {
            throw new IllegalArgumentException("í•¨ìˆ˜ ì£¼ì†Œ ê°’ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }
    }

    private static void validateLimit(FunctionEnvironmentDTO.Register reqDto) {
        if (!VALID_LIMIT_KEYS.contains(reqDto.getKey())) {
            throw new IllegalArgumentException("ì œí•œì‹œê°„ì˜ keyëŠ” minute ë˜ëŠ” secondë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        }
        if (!StringUtils.isNumeric(reqDto.getValue())) {
            throw new IllegalArgumentException("ì œí•œì‹œê°„ì„ ìˆ«ìë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        }
    }

    private static void validateMemory(FunctionEnvironmentDTO.Register reqDto) {
        if (!StringUtils.isNumeric(reqDto.getValue()) || Integer.parseInt(reqDto.getValue()) < MIN_MEMORY_VALUE) {
            throw new IllegalArgumentException("ë©”ëª¨ë¦¬ëŠ” 128 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        }
    }

    private static void validateEnv(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
        envCountChecker.incrementAndGet();
        if (StringUtils.isEmpty(reqDto.getKey()) || reqDto.getKey().contains(" ")) {
            throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ì˜ í‚¤ëŠ” ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (Pattern.matches("^[\\d]$", reqDto.getKey().substring(0, 1))) {
            throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ì˜ í‚¤ëŠ” ìˆ«ìë¡œ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (!reqDto.getKey().matches("^[a-zA-Z0-9._-]*$")) {
            throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì . _ - ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }
        if (reqDto.getKey().length() > MAX_KEY_LENGTH) {
            throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        }
        if (StringUtils.isNotEmpty(reqDto.getValue()) && reqDto.getValue().length() > MAX_VALUE_LENGTH) {
            throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ ê°’ì€ ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        }
    }

    private static void validateColdStart(FunctionEnvironmentDTO.Register reqDto) {
        if (!VALID_BOOLEAN_VALUES.contains(reqDto.getValue())) {
            throw new IllegalArgumentException("ì½œë“œìŠ¤íƒ€íŠ¸ ì—¬ë¶€ëŠ” Y ë˜ëŠ” Nìœ¼ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
        }
    }
}
ìœ„ ì½”ë“œì—ì„œ ì ìš©í•œ ê°œì„  ì‚¬í•­ê³¼ ì´ìœ ëŠ” ë‹¤ìŒ ì½”ë©˜íŠ¸ì—ì„œ ìì„¸íˆ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. ğŸš€







ë‚˜ì˜ ë§:
ê·¸ë˜. í•œë²ˆ ë§í•´ë´. ì–´ë–¤ ì ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ìì„¸íˆ  ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ ì•Œë ¤ì¤˜. ì–´ë–»ê²Œ ì½”ë“œí’ˆì§ˆì„ ê°œì„ ì‹œì¼°ëŠ”ì§€ ìì„¸íˆ ì•Œë ¤ì¤˜. ê´€ë ¨ëœ ê°œì„ ì‚¬í•­ë“¤ì— ëŒ€í•´ ì™œ ê°œì„ ì´ í•„ìš”í•œì§€ ì•Œë ¤ì£¼ê³ ,  í•„ìš” ì‹œ ê´€ë ¨ëœ ì½”ë“œë‚˜ ê¸°ìˆ  ê°œë…ê³¼ ì´ë¡ ì„ ìì„¸íˆ ì•Œë ¤ì¤˜.
ChatGPTì˜ ë§:
ğŸ“Œ ë¦¬íŒ©í† ë§ëœ ì½”ë“œì˜ ì£¼ìš” ê°œì„  ì‚¬í•­ (ë©”ì†Œë“œ ë‹¨ìœ„ ë¶„ì„)
1ï¸âƒ£ registerFunctionToken ë©”ì†Œë“œ ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
TokenDTO.Register ê°ì²´ë¥¼ ë”°ë¡œ ìƒì„± í›„, setterë¡œ í•„ë“œë¥¼ ì„¤ì •í–ˆìŒ â†’ ë¶ˆí•„ìš”í•œ setter í˜¸ì¶œ ë°œìƒ
new Date(new Date().getTime() + YEAR_SIZE_100) â†’ ë¶ˆí•„ìš”í•˜ê²Œ new Date() ë‘ ë²ˆ í˜¸ì¶œ
function.updateToken(token); â†’ í•¨ìˆ˜ì˜ ì±…ì„ì´ ì• ë§¤í•¨ (í† í°ì„ ìƒì„±í•˜ëŠ” ê²ƒì¸ì§€ ì €ì¥í•˜ëŠ” ê²ƒì¸ì§€?)
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
@Transactional
public FunctionDTO.Response registerFunctionToken(String functionKey) throws ParseException, JOSEException {
    Function function = functionRepository.findByFunctionKey(functionKey)
            .orElseThrow(() -> new ResourceNotFoundException("í‘ì…˜í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

    RSAKey rsaJWK = RSAKey.parse(functionService.registerJWK(new TokenDTO.Register(function, function.getFunctionKey())));

    SignedJWT signedJWT = createSignedJWT(
            new JWTClaimsSet.Builder()
                    .subject(function.getName())
                    .issuer("https://scp.com")
                    .expirationTime(new Date(System.currentTimeMillis() + YEAR_SIZE_100))
                    .build(),
            rsaJWK
    );

    function.updateToken(signedJWT.serialize());
    return function.toDto();
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
ë¶ˆí•„ìš”í•œ setter í˜¸ì¶œ ì œê±° (new TokenDTO.Register(function, function.getFunctionKey()) ë¡œ ì§ì ‘ ìƒì„±)
new Date(System.currentTimeMillis() + YEAR_SIZE_100) ë¡œ ë³€ê²½í•˜ì—¬ ë¶ˆí•„ìš”í•œ Date ê°ì²´ ìƒì„±ì„ ë°©ì§€
function.updateToken(token)ì€ ê·¸ëŒ€ë¡œ ë‘ì—ˆì§€ë§Œ, í•¨ìˆ˜ëª…ì„ ë” ëª…í™•í•˜ê²Œ ë³€ê²½í•˜ëŠ” ê²ƒë„ ê³ ë ¤í•  í•„ìš” ìˆìŒ (setToken() ë³´ë‹¤ëŠ” storeToken() ê°™ì€ ì´ë¦„ì´ ì ì ˆí•  ìˆ˜ë„ ìˆìŒ)
2ï¸âƒ£ createSignedJWT ë©”ì†Œë“œ ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
JWSSigner signer = new RSASSASigner(rsaJWK); ì™€ signedJWT.sign(signer); ê°€ ë¶„ë¦¬ë¨ â†’ ì—°ê´€ëœ ë¡œì§ì„ ë¬¶ëŠ” ê²ƒì´ ì¢‹ìŒ
signedJWT ê°ì²´ë¥¼ ë¨¼ì € ë§Œë“¤ê³ , sign()ì„ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ â†’ ìƒì„±ê³¼ ì„œëª…ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ SRP(Single Responsibility Principle) ìœ„ë°° ê°€ëŠ¥ì„± ìˆìŒ
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private SignedJWT createSignedJWT(JWTClaimsSet claimsSet, RSAKey rsaJWK) throws JOSEException {
    SignedJWT signedJWT = new SignedJWT(
            new JWSHeader.Builder(JWSAlgorithm.RS256).keyID(rsaJWK.getKeyID()).build(),
            claimsSet
    );
    signedJWT.sign(new RSASSASigner(rsaJWK));
    return signedJWT;
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
ì„œëª… ê³¼ì • (signer.sign())ì„ ê°ì²´ ìƒì„±ê³¼ í•¨ê»˜ ìˆ˜í–‰í•˜ë„ë¡ í†µí•©
ê°€ë…ì„±ì„ ë†’ì´ê³  ì½”ë“œì˜ ì‘ì§‘ë„ë¥¼ ê°•í™”
3ï¸âƒ£ registerFunctionEnvironment ë©”ì†Œë“œ ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ ê°œë³„ì ìœ¼ë¡œ ìˆ˜í–‰ (checkEnvironmentToken(), checkEnvironmentUrl() ë“±)
â†’ ì¤‘ë³µ ì½”ë“œ ë°œìƒ, ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì´ ë©”ì†Œë“œ ì—¬ëŸ¬ ê³³ì—ì„œ í˜¸ì¶œë¨
â†’ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¡œ í†µí•©í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì„
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
public FunctionEnvironmentDTO.Response registerFunctionEnvironment(FunctionEnvironmentDTO.Register reqDto, Function function, AtomicInteger envCountChecker) {
    validateEnvironment(reqDto, envCountChecker);
    reqDto.setFunctionSeq(function.getFunctionSeq());
    return functionEnvironmentRepository.save(FunctionEnvironment.register(reqDto)).toDto();
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
validateEnvironment()ë¼ëŠ” ë‹¨ì¼ ë©”ì†Œë“œë¡œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ ìˆ˜í–‰ â†’ ì¤‘ë³µ ì½”ë“œ ì œê±°
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ í•œ ê³³ì—ì„œ ìˆ˜í–‰í•˜ì—¬ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
4ï¸âƒ£ validateEnvironment ë©”ì†Œë“œ ì¶”ê°€ (í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ í†µí•©)
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
checkEnvironmentToken(), checkEnvironmentUrl() ë“± ê°œë³„ ë©”ì†Œë“œê°€ ê°ê° ì¡´ì¬ â†’ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì´ ì¼ê´€ë˜ì§€ ì•ŠìŒ (ì–´ë–¤ ê³³ì€ RuntimeException, ì–´ë–¤ ê³³ì€ IllegalArgumentException ì‚¬ìš©)
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateEnvironment(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
    switch (reqDto.getType()) {
        case "token":
            validateToken(reqDto);
            break;
        case "url":
            validateUrl(reqDto);
            break;
        case "limit":
            validateLimit(reqDto);
            break;
        case "memory":
            validateMemory(reqDto);
            break;
        case "env":
            validateEnv(reqDto, envCountChecker);
            break;
        case "coldStartYn":
            validateColdStart(reqDto);
            break;
        default:
            throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì…ë‹ˆë‹¤.");
    }
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
switch-case ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ í•˜ë‚˜ì˜ ë©”ì†Œë“œì—ì„œ ì²˜ë¦¬ â†’ ì¤‘ë³µ ì½”ë“œ ì œê±°
ì˜ëª»ëœ í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ ì¶”ê°€ (default ì¼€ì´ìŠ¤)
ìœ ì§€ë³´ìˆ˜ ì‹œ ìƒˆë¡œìš´ í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì´ ì¶”ê°€ë˜ë©´ ì´ ë©”ì†Œë“œë§Œ ìˆ˜ì •í•˜ë©´ ë¨ â†’ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
5ï¸âƒ£ validateToken ë©”ì†Œë“œ ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
"Y", "N" ê°’ì„ ì§ì ‘ ë¹„êµ
â†’ Set<String>ì„ ì‚¬ìš©í•˜ë©´ ë” ê¹”ë”í•˜ê³  í™•ì¥ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateToken(FunctionEnvironmentDTO.Register reqDto) {
    if (!VALID_BOOLEAN_VALUES.contains(reqDto.getValue())) {
        throw new IllegalArgumentException("í† í°ì‚¬ìš©ì—¬ë¶€ ê°’ì€ Y ë˜ëŠ” Nì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
    }
    if ("Y".equals(reqDto.getValue()) && StringUtils.isEmpty(reqDto.getKey())) {
        throw new IllegalArgumentException("í† í° ê°’ì´ Yì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
    }
    if ("N".equals(reqDto.getValue()) && StringUtils.isNotEmpty(reqDto.getKey())) {
        throw new IllegalArgumentException("í† í° ê°’ì´ Nì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
Set<String> VALID_BOOLEAN_VALUES = Set.of("Y", "N");ì„ ì‚¬ìš©í•˜ì—¬ ë¹„êµ â†’ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
ê° ì˜ˆì™¸ ì¼€ì´ìŠ¤ë¥¼ ëª…í™•íˆ ì •ì˜í•˜ì—¬ ì˜ëª»ëœ ì…ë ¥ ë°©ì§€
6ï¸âƒ£ validateEnv ë©”ì†Œë“œ ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ì½”ë“œ ë¬¸ì œì 
ì •ê·œì‹ ê²€ì¦ì„ ì¤‘ë³µí•´ì„œ ìˆ˜í–‰ (Pattern.matches() í˜¸ì¶œì´ ì—¬ëŸ¬ ë²ˆ ì¡´ì¬)
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateEnv(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
    envCountChecker.incrementAndGet();
    if (StringUtils.isEmpty(reqDto.getKey()) || reqDto.getKey().contains(" ")) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ì˜ í‚¤ëŠ” ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    if (!reqDto.getKey().matches("^[a-zA-Z_][a-zA-Z0-9._-]*$")) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì . _ - ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    }
    if (reqDto.getKey().length() > MAX_KEY_LENGTH) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
    if (StringUtils.isNotEmpty(reqDto.getValue()) && reqDto.getValue().length() > MAX_VALUE_LENGTH) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ ê°’ì€ ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
}
ğŸ”¹ ê°œì„ ëœ ì´ìœ 
ì •ê·œì‹ì„ í•œ ì¤„ë¡œ í†µí•© (^[a-zA-Z_][a-zA-Z0-9._-]*$) â†’ ê°€ë…ì„± ë° ì„±ëŠ¥ í–¥ìƒ
envCountChecker.incrementAndGet();ì„ ë” ì§ê´€ì ì¸ ìœ„ì¹˜ë¡œ ì´ë™
ğŸ¯ ê²°ë¡ 
âœ… ì½”ë“œ ì¤‘ë³µ ì œê±° â†’ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
âœ… í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ë¡œì§ í†µí•© â†’ ì½”ë“œ ê°€ë…ì„± ë° í™•ì¥ì„± ê°œì„ 
âœ… ì •ê·œì‹ ìµœì í™” â†’ ì„±ëŠ¥ í–¥ìƒ
âœ… ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬ ì ìš© â†’ ì˜¤ë¥˜ ë°©ì§€ ê°•í™”

ì´ì œ ì½”ë“œê°€ ë” ëª…í™•í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš€
