ì•„ë˜ëŠ” ìš”ì²­í•˜ì‹  ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ í´ë¦° ì½”ë“œì™€ ë¦¬íŒ©í† ë§ ê´€ì ì—ì„œì˜ ë¦¬ë·° ì½”ë©˜íŠ¸ì…ë‹ˆë‹¤. ë”°ëœ»í•œ ê²©ë ¤ì™€ í•¨ê»˜ êµ¬ì²´ì ì¸ ê¸°ìˆ  íŒë„ í¬í•¨í–ˆìœ¼ë‹ˆ ì°¸ê³ í•´ë³´ì„¸ìš”!


---

1. updateFunctionStatus ë©”ì„œë“œ

@PutMapping("status/{name}")
@Operation(summary = "í‘ì…˜ ìƒíƒœ ë³€ê²½", description = "í‘ì…˜ì˜ ìƒíƒœ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸")
public ResponseEntity<FunctionDTO.Response> updateFunctionStatus(@Valid @RequestBody FunctionDTO.Modify functionDtos, @PathVariable("name") String name) throws IOException {
    FunctionDTO.Response response = functionService.updateFunctionStatus(functionDtos, name);
    return ResponseEntity.status(HttpStatus.OK).body(response);
}

ì½”ë©˜íŠ¸:

"í‘ì…˜ì˜ ìƒíƒœ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸"ë¼ëŠ” ê¸°ëŠ¥ì´ ì˜ ë“œëŸ¬ë‚˜ëŠ” ê¹”ë”í•œ ë©”ì„œë“œë„¤ìš”! ğŸ‘ í•˜ì§€ë§Œ ë©”ì„œë“œ ì´ë¦„ì„ ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ, ì˜ˆë¥¼ ë“¤ì–´ updateFunctionStatusByNameì²˜ëŸ¼ í•˜ë©´ nameì´ë¼ëŠ” PathVariableì˜ ì˜ë¯¸ë¥¼ ëª…í™•íˆ ì „ë‹¬í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.

ë˜í•œ functionDtos ê°ì²´ë¥¼ ì¢€ ë” ì‘ì€ ë‹¨ìœ„ì˜ ê°ì²´ë¡œ ë‚˜ëˆ ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ë©´ ê°€ë…ì„±ì´ ë” ì¢‹ì•„ì§ˆ ê²ƒ ê°™ì•„ìš”. ì˜ˆë¥¼ ë“¤ì–´, ìƒíƒœ ì—…ë°ì´íŠ¸ì— ê¼­ í•„ìš”í•œ í•„ë“œë§Œ ë‹´ê¸´ DTOë¥¼ ë³„ë„ë¡œ ë§Œë“¤ë©´ ì¢‹ìŠµë‹ˆë‹¤.

ì˜ˆì‹œ ì½”ë“œ:


public ResponseEntity<FunctionDTO.Response> updateFunctionStatus(@Valid @RequestBody FunctionStatusUpdateRequest request, @PathVariable String name) {
    FunctionDTO.Response response = functionService.updateStatus(request, name);
    return ResponseEntity.ok(response);
}

ì´ë ‡ê²Œ í•˜ë©´ FunctionDTO.Modifyê°€ ë„ˆë¬´ ë§ì€ í•„ë“œë¥¼ í¬í•¨í•˜ê³  ìˆì„ ê°€ëŠ¥ì„±ì„ ì¤„ì´ê³ , ì˜ë„ë¥¼ ë¶„ëª…íˆ ì „ë‹¬í•  ìˆ˜ ìˆì–´ìš”.


---

2. registerFunctionCode ë©”ì„œë“œ

@PostMapping("source-code/{functionKey}")
@Operation(summary = "í‘ì…˜ ì½”ë“œ ë“±ë¡", description = "í‘ì…˜ ì½”ë“œë¥¼ ë“±ë¡í•œë‹¤.")
public ResponseEntity<FunctionDTO.Response> registerFunctionCode(@Valid @RequestBody FunctionDTO.Register reqDto, @PathVariable("functionKey") String functionKey) throws IOException, ParseException {
    FunctionDTO.Response response = functionService.registerFunctionCode(reqDto, functionKey);
    return ResponseEntity.status(HttpStatus.CREATED).body(response);
}

ì½”ë©˜íŠ¸:

ìš”ì²­ ë°”ë””(reqDto)ì™€ ê²½ë¡œ ë³€ìˆ˜(functionKey)ê°€ ëª…í™•í•˜ê²Œ êµ¬ë¶„ë˜ì–´ ìˆì–´ ì˜ ì‘ì„±í•˜ì…¨ì–´ìš”! ğŸ’¡ ë‹¤ë§Œ, ì˜ˆì™¸ ì²˜ë¦¬(IOException, ParseException)ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆë²¨ì—ì„œ ì „ì—­ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì„ ë„ì…í•˜ë©´ ì½”ë“œê°€ ë” ê°„ê²°í•´ì§ˆ ê²ƒ ê°™ì•„ìš”.

ì˜ˆë¥¼ ë“¤ì–´, @ControllerAdviceë¥¼ í™œìš©í•´ ê³µí†µ ì˜ˆì™¸ í•¸ë“¤ë§ ë¡œì§ì„ ë§Œë“¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ì§‘ì¤‘ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:


@ExceptionHandler({IOException.class, ParseException.class})
public ResponseEntity<String> handleIOException(Exception ex) {
    return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(ex.getMessage());
}


---

3. switchLogging ë©”ì„œë“œ

@PutMapping("cloudlogging/{functionKey}")
@Operation(summary = "ë¡œê¹… ON/OFF", description = "í´ë¼ìš°ë“œ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ë¡œê¹… ON/OFF")
public ResponseEntity<CloudLoggingDTO.Response> switchLogging(@Valid @RequestBody CloudLoggingDTO.Modify cloudLoggingDtos, @PathVariable("functionKey") String functionKey) throws IOException {
    CloudLoggingDTO.Response response = functionService.switchLogging(cloudLoggingDtos, functionKey);
    return ResponseEntity.status(HttpStatus.CREATED).body(response);
}

ì½”ë©˜íŠ¸:

í´ë¼ìš°ë“œ ë¡œê¹… ê´€ë ¨ ê¸°ëŠ¥ì´ ì˜ êµ¬í˜„ë˜ì–´ ìˆë„¤ìš”! ğŸ‘ í•˜ì§€ë§Œ switchLoggingì´ë¼ëŠ” ì´ë¦„ì€ ON/OFF ì—¬ë¶€ë¥¼ ëª…í™•íˆ ë‚˜íƒ€ë‚´ì§€ ì•Šì•„ì„œ, ì¡°ê¸ˆ ë” êµ¬ì²´ì ì¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, toggleLogging ë˜ëŠ” setLoggingStateì²˜ëŸ¼ ì´ë¦„ì„ ë³€ê²½í•´ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

ë˜í•œ ë¡œê¹… ìƒíƒœë¥¼ ON/OFFë¡œ ë³€ê²½í•˜ëŠ” ë¡œì§ì´ boolean ê°’ì„ í™œìš©í•˜ê³  ìˆë‹¤ë©´, ìš”ì²­ ë°”ë””ì— isEnabledì™€ ê°™ì€ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”. ìš”ì²­ êµ¬ì¡°ë¥¼ ê°„ì†Œí™”í•˜ë©´ ë” ì§ê´€ì ì¸ APIê°€ ë©ë‹ˆë‹¤.



---

4. SecurityConstantsì˜ SECURITY_EXCLUDE_URLS

public static final String[] SECURITY_EXCLUDE_URLS = {
    "/v3/api-docs/**", "/swagger-ui/index.html",
    "/login",
    "/api/v1/function/knative/*",
    "/h2-console/**",
    "/api/v1/function/status/*" // í•¨ìˆ˜ ìƒíƒœ ì•Œë¦¼ ì—…ë°ì´íŠ¸ ì˜ˆì™¸ ì²˜ë¦¬ (scf-watcher -> scf-manager)
};

ì½”ë©˜íŠ¸:

ì´ ìƒìˆ˜ëŠ” ì˜ ì„¤ê³„ë˜ì–´ ìˆì§€ë§Œ, URLì„ í•˜ë“œì½”ë”©í•˜ê¸°ë³´ë‹¤ëŠ” í™˜ê²½ ì„¤ì • íŒŒì¼(application.yml ë“±)ë¡œ ê´€ë¦¬í•˜ê±°ë‚˜ Enumìœ¼ë¡œ ì¶”ì¶œí•˜ë©´ ë” ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤. ğŸ’¡

ì˜ˆë¥¼ ë“¤ì–´, YAML íŒŒì¼ì—ì„œ ê´€ë¦¬:


security:
  exclude-urls:
    - /v3/api-docs/**
    - /swagger-ui/index.html
    - /login
    - /api/v1/function/knative/*
    - /h2-console/**
    - /api/v1/function/status/*

ê·¸ë¦¬ê³  ì´ë¥¼ ë¡œë“œí•˜ëŠ” ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©:


@Configuration
public class SecurityConfig {
    @Value("${security.exclude-urls}")
    private List<String> excludeUrls;
}


---

ì „ì²´ì ì¸ ì¹­ì°¬ ë° ì œì•ˆ

1. ì¹­ì°¬: ì½”ë“œì˜ êµ¬ì¡°ì™€ ì£¼ì„ì´ ì˜ ì •ë¦¬ë˜ì–´ ìˆì–´ ë‹¤ë¥¸ ê°œë°œìê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ í™˜ê²½ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤! ğŸ’ª


2. ì œì•ˆ: ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë” ë†’ì´ê¸° ìœ„í•´ DTO, Enum, ìƒìˆ˜ë¥¼ ì˜ ë¶„ë¦¬í•˜ê³ , Exception ì²˜ë¦¬ë¥¼ ë” ì„¸ë¶„í™”í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.


3. ë§ˆì§€ë§‰ìœ¼ë¡œ: ì´ë ‡ê²Œ ì˜ ì‘ì„±ëœ ì½”ë“œê°€ íŒ€ì˜ ë‹¤ë¥¸ ë©¤ë²„ë“¤ì—ê²Œ í° ë„ì›€ì´ ë  ê²ƒ ê°™ì•„ìš”. í•­ìƒ ì‘ì›í•©ë‹ˆë‹¤! ğŸ˜Š




---

Q1. DTOì™€ ê´€ë ¨ëœ ë¡œì§ì„ í´ë¦° ì½”ë“œ ê´€ì ì—ì„œ ë” ê°œì„ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?

Q2. SecurityConstantsì— ìˆëŠ” URL ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ë” ìœ ì—°í•˜ê²Œ ì„¤ê³„í•  ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€?

Q3. í´ë¼ìš°ë“œ ë¡œê¹… ON/OFF ê¸°ëŠ¥ì— ëŒ€í•œ API ì„¤ê³„ì™€ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì–´ë–¤ ì¶”ê°€ì ì¸ ì ‘ê·¼ ë°©ì‹ì„ ê³ ë ¤í•  ìˆ˜ ìˆì„ê¹Œ?

