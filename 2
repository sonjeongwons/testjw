ì¢‹ì•„. Knative Servingì˜ Service ë¦¬ì†ŒìŠ¤ë¥¼ Watchí•˜ê³  ìˆëŠ” Kubernetes Operator ì½”ë“œì—ì„œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ ì‹œì—ëŠ” Reconcileì´ ì‘ë™í•˜ì§€ ì•Šë„ë¡ í•˜ë ¤ë©´, Delete ì´ë²¤íŠ¸ì— ëŒ€í•´ ë¬´ì‹œí•˜ê±°ë‚˜ early returnì„ ì²˜ë¦¬í•´ì£¼ëŠ” ë¡œì§ì„ Reconcile í•¨ìˆ˜ ë‚´ì— ì¶”ê°€í•´ì£¼ë©´ ë¼. ì¼ë°˜ì ìœ¼ë¡œ ì•„ë˜ ë‘ ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´:


---

âœ… ë°©ë²• 1. Reconcile ë‚´ì—ì„œ ì‚­ì œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ê°ì§€í•˜ê³  ë°”ë¡œ return

func (r *YourReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
    log := log.FromContext(ctx)

    var svc servingv1.Service
    if err := r.Get(ctx, req.NamespacedName, &svc); err != nil {
        if apierrors.IsNotFound(err) {
            // ğŸ‘‰ ì‚­ì œëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ì„  Reconcile í•˜ì§€ ì•ŠìŒ
            log.Info("Knative Service has been deleted, skipping reconciliation", "name", req.NamespacedName)
            return ctrl.Result{}, nil
        }
        return ctrl.Result{}, err
    }

    // ... ì—¬ê¸°ì— ë‚˜ë¨¸ì§€ ë¡œì§
}

IsNotFound ì—ëŸ¬ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ì–´ API ì„œë²„ì— ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•¨.

ì´ ì‹œì ì—ì„œ ë°”ë¡œ ë¦¬í„´í•˜ë©´, ì‚­ì œ ì´ë²¤íŠ¸ëŠ” ì‚¬ì‹¤ìƒ ë¬´ì‹œë¨.



---

âœ… ë°©ë²• 2. ì»¨íŠ¸ë¡¤ëŸ¬ ë“±ë¡ ì‹œ Delete ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œ

controller-runtimeì˜ WithEventFilterë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. Predicateì—ì„œ DeleteFuncë§Œ í•„í„°ë§í•˜ë©´ ë¨:

import (
    "sigs.k8s.io/controller-runtime/pkg/event"
    "sigs.k8s.io/controller-runtime/pkg/predicate"
)

func (r *YourReconciler) SetupWithManager(mgr ctrl.Manager) error {
    return ctrl.NewControllerManagedBy(mgr).
        For(&servingv1.Service{}).
        WithEventFilter(predicate.Funcs{
            DeleteFunc: func(e event.DeleteEvent) bool {
                // ğŸ‘‰ Delete ì´ë²¤íŠ¸ ë¬´ì‹œ
                return false
            },
        }).
        Complete(r)
}

ì´ ë°©ì‹ì€ Reconcile()ì´ ì•„ì˜ˆ í˜¸ì¶œë˜ì§€ ì•Šë„ë¡ í•¨.

ë‹¤ë§Œ, ì¼ë¶€ Finalizerë¥¼ í™œìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¼ë©´ DeleteFunc í•„í„°ë§ë³´ë‹¨ ìœ„ì˜ ë°©ì‹(ë°©ë²• 1)ì´ ë” ì ì ˆí•  ìˆ˜ ìˆìŒ.



---

âœ¨ ì •ë¦¬

ë°©ë²•	ì„¤ëª…	íŠ¹ì§•

ë°©ë²• 1	Reconcile() ë‚´ì—ì„œ IsNotFound ì‹œ ë¦¬í„´	ì•ˆì „í•˜ê³  ìœ ì—°í•¨. Finalizerë„ ëŒ€ì‘ ê°€ëŠ¥
ë°©ë²• 2	WithEventFilter()ë¡œ DeleteEvent ë¬´ì‹œ	ì™„ì „íˆ ë¬´ì‹œí•˜ê³  ì‹¶ì€ ê²½ìš° ì í•©



---

âœ… ì¶”ì²œ

Knative Serviceê°€ ì‹¤ì œ ì‚­ì œëì„ ë•Œ Finalizer ë“± ì²˜ë¦¬í•  ê²ƒì´ ì—†ë‹¤ë©´, ë°©ë²• 2 (WithEventFilter)ë¡œ Delete ì´ë²¤íŠ¸ ìì²´ë¥¼ ë¬´ì‹œí•˜ëŠ” ê±¸ ì¶”ì²œí•´. ì„±ëŠ¥ìƒ ìœ ë¦¬í•˜ê³ , ë¶ˆí•„ìš”í•œ ë¦¬ì†ŒìŠ¤ íƒìƒ‰ë„ ë°©ì§€ë¼.


---

Q1: Knative Serviceì— Finalizerê°€ ìˆì„ ë•Œë„ Delete ì´ë²¤íŠ¸ë¥¼ ë¬´ì‹œí•´ë„ ê´œì°®ì„ê¹Œ?
Q2: í˜„ì¬ Operatorê°€ Reconcile ì¤‘ Knative Serviceë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê°±ì‹ í•˜ëŠ” ë¡œì§ë„ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
Q3: í˜¹ì‹œ Reconcile ì‹œ ëŒ€ìƒ ë¦¬ì†ŒìŠ¤ê°€ ì‹¤ì œ ì¡´ì¬í•˜ì§€ ì•Šì•„ë„ ë™ì‘í•´ì•¼ í•˜ëŠ” ì´ìœ ê°€ ë”°ë¡œ ìˆëŠ”ê°€?

