ğŸ“‹ PR ê°œìš”
ì´ë²ˆ PRì—ì„œëŠ” FunctionEnvironmentService í´ë˜ìŠ¤ì˜ ì½”ë“œ í’ˆì§ˆì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
í´ë¦° ì½”ë“œ ì›ì¹™ (SOLID, DRY, KISS, YAGNI, SRP) ì„ ì ìš©í•˜ì—¬ ì¤‘ë³µ ì œê±°, ê°€ë…ì„± í–¥ìƒ, ì„±ëŠ¥ ìµœì í™”, ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ ì„ ëª©í‘œë¡œ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

ğŸ›  ê°œë°œ ë‚´ìš©
1ï¸âƒ£ ì½”ë“œ ì¤‘ë³µ ì œê±° ë° ê³µí†µ ë¡œì§ ë¶„ë¦¬
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ ë‹¨ì¼ ë©”ì†Œë“œ (validateEnvironment) ë¡œ í†µí•©í•˜ì—¬ ì¤‘ë³µ ì œê±°
ì •ê·œì‹ ê²€ì¦ì„ ë‹¨ìˆœí™”í•˜ì—¬ ì½”ë“œ ê°€ë…ì„± í–¥ìƒ (validateEnv ë‚´ë¶€ ê°œì„ )
2ï¸âƒ£ ë¶ˆí•„ìš”í•œ ê°ì²´ ë° ë³€ìˆ˜ ì œê±°
new Date(new Date().getTime() + YEAR_SIZE_100) â†’ ë¶ˆí•„ìš”í•œ new Date() ê°ì²´ ìƒì„± ì œê±°
Set<String>ì„ í™œìš©í•˜ì—¬ ë°˜ë³µì ì¸ ì¡°ê±´ë¬¸ì„ ë‹¨ìˆœí™” (VALID_BOOLEAN_VALUES, VALID_PROTOCOLS ë“±)
3ï¸âƒ£ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
switch-caseë¥¼ í™œìš©í•œ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ (validateEnvironment ì¶”ê°€)
try-with-resourcesë¥¼ í™œìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ë°©ì§€
new TokenDTO.Register(function, function.getFunctionKey()) ë¡œ ì§ì ‘ ê°ì²´ ìƒì„±í•˜ì—¬ setter ì‚¬ìš© ìµœì†Œí™”
4ï¸âƒ£ ì„±ëŠ¥ ìµœì í™”
ì •ê·œì‹ ê²€ì¦ ìµœì í™” (Pattern.matches() ì œê±°, .matches() ë©”ì†Œë“œ í™œìš©)
System.currentTimeMillis() í™œìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„± ê°ì†Œ
5ï¸âƒ£ ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ 
RuntimeException â†’ ë³´ë‹¤ ëª…í™•í•œ ì˜ˆì™¸ (IllegalArgumentException, ResourceNotFoundException) ë¡œ ë³€ê²½
í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì´ ì˜ëª»ëœ ê²½ìš° default ì˜ˆì™¸ ì²˜ë¦¬ ì¶”ê°€
ğŸ” ë©”ì†Œë“œë³„ ë³€ê²½ì ê³¼ ê°œì„ ì‚¬í•­
1ï¸âƒ£ registerFunctionToken ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
ë¶ˆí•„ìš”í•œ new Date() í˜¸ì¶œ
TokenDTO.Register ê°ì²´ì— setter ì‚¬ìš©
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
@Transactional
public FunctionDTO.Response registerFunctionToken(String functionKey) throws ParseException, JOSEException {
    Function function = functionRepository.findByFunctionKey(functionKey)
            .orElseThrow(() -> new ResourceNotFoundException("í‘ì…˜í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

    RSAKey rsaJWK = RSAKey.parse(functionService.registerJWK(new TokenDTO.Register(function, function.getFunctionKey())));

    SignedJWT signedJWT = createSignedJWT(
            new JWTClaimsSet.Builder()
                    .subject(function.getName())
                    .issuer("https://scp.com")
                    .expirationTime(new Date(System.currentTimeMillis() + YEAR_SIZE_100))
                    .build(),
            rsaJWK
    );

    function.updateToken(signedJWT.serialize());
    return function.toDto();
}
âœ… setter ì œê±°, System.currentTimeMillis() í™œìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„± ìµœì†Œí™”

2ï¸âƒ£ createSignedJWT ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
ì„œëª… ê³¼ì • (signer.sign())ì´ ë¶„ë¦¬ë¨ â†’ SRP ì›ì¹™ ìœ„ë°° ê°€ëŠ¥ì„±
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private SignedJWT createSignedJWT(JWTClaimsSet claimsSet, RSAKey rsaJWK) throws JOSEException {
    SignedJWT signedJWT = new SignedJWT(
            new JWSHeader.Builder(JWSAlgorithm.RS256).keyID(rsaJWK.getKeyID()).build(),
            claimsSet
    );
    signedJWT.sign(new RSASSASigner(rsaJWK));
    return signedJWT;
}
âœ… ê°ì²´ ìƒì„±ê³¼ ì„œëª…ì„ í•˜ë‚˜ì˜ ê³¼ì •ìœ¼ë¡œ í†µí•© â†’ ì‘ì§‘ë ¥ í–¥ìƒ

3ï¸âƒ£ registerFunctionEnvironment ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì´ ë©”ì†Œë“œ ì—¬ëŸ¬ ê°œë¡œ ë¶„ì‚°ë¨ (checkEnvironmentToken(), checkEnvironmentUrl() ë“±)
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
public FunctionEnvironmentDTO.Response registerFunctionEnvironment(FunctionEnvironmentDTO.Register reqDto, Function function, AtomicInteger envCountChecker) {
    validateEnvironment(reqDto, envCountChecker);
    reqDto.setFunctionSeq(function.getFunctionSeq());
    return functionEnvironmentRepository.save(FunctionEnvironment.register(reqDto)).toDto();
}
âœ… ê²€ì¦ ë¡œì§ì„ validateEnvironmentë¡œ í†µí•©í•˜ì—¬ ì¤‘ë³µ ì œê±°

4ï¸âƒ£ validateEnvironment ì¶”ê°€
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
ê²€ì¦ ë©”ì†Œë“œê°€ ê°œë³„ì ìœ¼ë¡œ ì¡´ì¬í•˜ì—¬ ì¤‘ë³µ ì½”ë“œ ë°œìƒ, ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
ìƒˆë¡œìš´ í™˜ê²½ ë³€ìˆ˜ íƒ€ì… ì¶”ê°€ ì‹œ ì—¬ëŸ¬ ë©”ì†Œë“œ ìˆ˜ì • í•„ìš”
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateEnvironment(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
    switch (reqDto.getType()) {
        case "token":
            validateToken(reqDto);
            break;
        case "url":
            validateUrl(reqDto);
            break;
        case "limit":
            validateLimit(reqDto);
            break;
        case "memory":
            validateMemory(reqDto);
            break;
        case "env":
            validateEnv(reqDto, envCountChecker);
            break;
        case "coldStartYn":
            validateColdStart(reqDto);
            break;
        default:
            throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ í™˜ê²½ ë³€ìˆ˜ íƒ€ì…ì…ë‹ˆë‹¤.");
    }
}
âœ… ë‹¨ì¼ ë©”ì†Œë“œì—ì„œ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ì„ ì²˜ë¦¬ â†’ ìƒˆë¡œìš´ íƒ€ì… ì¶”ê°€ ì‹œ ìœ ì§€ë³´ìˆ˜ ìš©ì´

5ï¸âƒ£ validateToken ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
"Y", "N" ê°’ì„ ì§ì ‘ ë¹„êµ â†’ Set<String> ì‚¬ìš© ê°€ëŠ¥
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateToken(FunctionEnvironmentDTO.Register reqDto) {
    if (!VALID_BOOLEAN_VALUES.contains(reqDto.getValue())) {
        throw new IllegalArgumentException("í† í°ì‚¬ìš©ì—¬ë¶€ ê°’ì€ Y ë˜ëŠ” Nì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
    }
    if ("Y".equals(reqDto.getValue()) && StringUtils.isEmpty(reqDto.getKey())) {
        throw new IllegalArgumentException("í† í° ê°’ì´ Yì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
    }
    if ("N".equals(reqDto.getValue()) && StringUtils.isNotEmpty(reqDto.getKey())) {
        throw new IllegalArgumentException("í† í° ê°’ì´ Nì¸ ê²½ìš° í‚¤ë¥¼ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}
âœ… Set<String>ì„ ì‚¬ìš©í•˜ì—¬ ë¹„êµ ì—°ì‚° ìµœì í™”

6ï¸âƒ£ validateEnv ê°œì„ 
ğŸ”¹ ê¸°ì¡´ ë¬¸ì œì 
ì •ê·œì‹ ê²€ì¦ì„ ì¤‘ë³µí•´ì„œ ìˆ˜í–‰ (Pattern.matches() í˜¸ì¶œ ì—¬ëŸ¬ ë²ˆ)
âœ… ê°œì„  ì‚¬í•­
java
ë³µì‚¬
í¸ì§‘
private static void validateEnv(FunctionEnvironmentDTO.Register reqDto, AtomicInteger envCountChecker) {
    envCountChecker.incrementAndGet();
    if (StringUtils.isEmpty(reqDto.getKey()) || reqDto.getKey().contains(" ")) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ì˜ í‚¤ëŠ” ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    if (!reqDto.getKey().matches("^[a-zA-Z_][a-zA-Z0-9._-]*$")) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì . _ - ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    }
    if (reqDto.getKey().length() > MAX_KEY_LENGTH) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ í‚¤ëŠ” ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
    if (StringUtils.isNotEmpty(reqDto.getValue()) && reqDto.getValue().length() > MAX_VALUE_LENGTH) {
        throw new IllegalArgumentException("í™˜ê²½ë³€ìˆ˜ ê°’ì€ ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    }
}
âœ… ì •ê·œì‹ ê²€ì¦ì„ í•œ ì¤„ë¡œ ë‹¨ìˆœí™”í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ

ğŸ¯ ê¸°ëŒ€ íš¨ê³¼
âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° â†’ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
âœ… í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ë¡œì§ í†µí•© â†’ ì½”ë“œ ê°€ë…ì„± ë° í™•ì¥ì„± ê°œì„ 
âœ… ì •ê·œì‹ ìµœì í™” â†’ ì„±ëŠ¥ í–¥ìƒ
âœ… ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬ ì ìš© â†’ ì˜¤ë¥˜ ë°©ì§€ ê°•í™”
