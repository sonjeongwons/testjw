ksvc.Status.Conditions ë°°ì—´ì´ ë¹„ì–´ìˆê±°ë‚˜ Ready íƒ€ì…ì˜ ì¡°ê±´ì´ ì¡´ì¬í•˜ì§€ë§Œ ì•„ì§ Status í•„ë“œê°€ ì±„ì›Œì§€ì§€ ì•Šì•˜ì„ ë•Œ, Managerì— ìƒíƒœë¥¼ ì „ì†¡í•˜ì§€ ì•Šë„ë¡ ì¡°ê±´ì„ ëª…í™•íˆ í•´ì•¼ í•©ë‹ˆë‹¤.

âœ… ê°œì„  ë°©í–¥
ksvc.Status.Conditions ìì²´ê°€ ë¹„ì–´ìˆë‹¤ë©´ ìƒíƒœ ì „ì†¡í•˜ì§€ ì•ŠìŒ.

Ready íƒ€ì… ì¡°ê±´ì´ ìˆë”ë¼ë„ .Status í•„ë“œê°€ ë¹„ì–´ ìˆê±°ë‚˜ Unknownì´ë©´ ì „ì†¡í•˜ì§€ ì•ŠìŒ.

ìƒíƒœê°€ ìœ íš¨í•œ ê²½ìš°ì—ë§Œ ì „ì†¡ (True, False).

ğŸ›  ìˆ˜ì •ëœ í•µì‹¬ ì½”ë“œ
go
ë³µì‚¬
í¸ì§‘
// getStatusFromKsvc í•¨ìˆ˜ëŠ” Knative ì„œë¹„ìŠ¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
func getStatusFromKsvc(ksvc servingv1.Service) (string, bool) {
	for _, condition := range ksvc.Status.Conditions {
		if condition.Type == "Ready" {
			switch condition.Status {
			case corev1.ConditionTrue:
				return "True", true
			case corev1.ConditionFalse:
				return "False", true
			case corev1.ConditionUnknown:
				return "Unknown", false // Unknown ìƒíƒœì¼ ë• ì•„ì§ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
			default:
				return "Unknown", false
			}
		}
	}
	return "Unknown", false
}
ê·¸ë¦¬ê³  Reconcileì—ì„œ ì´ ë°˜í™˜ê°’ì„ ê²€ì‚¬í•˜ì—¬ ì¡°ê±´ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

go
ë³µì‚¬
í¸ì§‘
	currentStatus, valid := getStatusFromKsvc(ksvc)
	if !valid {
		logger.Info("Knative Service ìƒíƒœê°€ ì•„ì§ ìœ íš¨í•˜ì§€ ì•Šì•„ ìƒíƒœë¥¼ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
		return ctrl.Result{RequeueAfter: 5 * time.Second}, nil
	}
ì „ì²´ ì ìš©ëœ ë¶€ë¶„ ìš”ì•½
go
ë³µì‚¬
í¸ì§‘
import "time" // RequeueAfterë¥¼ ìœ„í•œ ì„í¬íŠ¸ ì¶”ê°€

...

func (r *ScfWatcherReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
	logger := log.FromContext(ctx)
	logger.Info("Reconcile ì‹œì‘")

	var scfWatcher modulev1.ScfWatcher
	if err := r.Get(ctx, req.NamespacedName, &scfWatcher); err != nil {
		logger.Error(err, "Unable to fetch ScfWatcher")
		return ctrl.Result{}, client.IgnoreNotFound(err)
	}

	var ksvc servingv1.Service
	if err := r.Get(ctx, client.ObjectKey{Namespace: scfWatcher.Spec.KsvcNamespace, Name: scfWatcher.Spec.KsvcName}, &ksvc); err != nil {
		logger.Error(err, "Unable to fetch Knative Service")
		return ctrl.Result{}, err
	}

	if len(ksvc.Status.Conditions) == 0 {
		logger.Info("ksvcê°€ ì¡´ì¬í•˜ì§€ë§Œ ì»¨ë””ì…˜ì´ ì•„ì§ ì—†ìŒ")
		return ctrl.Result{RequeueAfter: 5 * time.Second}, nil
	}

	currentStatus, valid := getStatusFromKsvc(ksvc)
	if !valid {
		logger.Info("Knative Service ìƒíƒœê°€ ì•„ì§ ìœ íš¨í•˜ì§€ ì•Šì•„ ìƒíƒœë¥¼ ì „ì†¡í•˜ì§€ ì•ŠìŒ")
		return ctrl.Result{RequeueAfter: 5 * time.Second}, nil
	}

	logger.Info("ê¸°ì¡´ìƒíƒœ : " + scfWatcher.Status.LastKsvcStatus)
	logger.Info("ì‹ ê·œìƒíƒœ : " + currentStatus)

	if scfWatcher.Status.LastKsvcStatus == currentStatus {
		return ctrl.Result{}, nil
	}

	// ì´í›„ ë™ì¼í•œ ìƒíƒœ ì „ì†¡ ë¡œì§...
ì´ë ‡ê²Œ í•˜ë©´ Knative Serviceê°€ ì•„ì§ ì¤€ë¹„ ì¤‘ì´ë¼ .status.conditions ë°°ì—´ì´ ë¹„ì–´ìˆê±°ë‚˜ Unknown ìƒíƒœì¼ ë•Œ ë¶ˆí•„ìš”í•˜ê²Œ Managerì— ì˜ëª»ëœ ìƒíƒœë¥¼ ì „ì†¡í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.

í•„ìš”í•˜ë‹¤ë©´ RequeueAfter ì‹œê°„ì„ ì¡°ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (5ì´ˆ, 10ì´ˆ ë“±).




