Pull Request: BaseImageService ì½”ë“œ ë¦¬íŒ©í† ë§ ë° í’ˆì§ˆ ê°œì„ 

PR ê°œìš”

ë³¸ PRì—ì„œëŠ” BaseImageService í´ë˜ìŠ¤ì˜ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í•˜ê³ , ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ê°€ë…ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ ì½”ë“œì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ìœ ì§€ë³´ìˆ˜ì„± ë¬¸ì œ, ê°€ë…ì„± ì €í•˜, ì˜ˆì™¸ ì²˜ë¦¬ ì¼ê´€ì„± ë¶€ì¡± ë“±ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ê·¹ëŒ€í™”í•˜ê³ ,
ì¼ê´€ëœ DTO ë³€í™˜ ë°©ì‹ì„ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

ê°œë°œ ë‚´ìš©

âœ… 1. ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ë©”ì†Œë“œ ë¶„ë¦¬

baseImageRepository.findById() í˜¸ì¶œ í›„ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ” ë¡œì§ì´ ì¤‘ë³µë˜ì–´ ìˆì—ˆìŒ.

AppUtil.getMapper().map(...)ì„ ì—¬ëŸ¬ ê³³ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ DTO ë³€í™˜ì„ ìˆ˜í–‰í–ˆìŒ.

ìœ„ì™€ ê°™ì€ ë°˜ë³µì ì¸ ë¡œì§ì„ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œ ì¤‘ë³µì„ ì œê±°í•˜ê³  ì¬ì‚¬ìš©ì„±ì„ ë†’ì„.


âœ… 2. ì½”ë“œ ê°€ë…ì„± ê°œì„ 

ê¸´ ëŒë‹¤ì‹ì„ ì œê±°í•˜ê³  ë³„ë„ ë©”ì†Œë“œ(compareBaseImages())ë¡œ ë¶„ë¦¬í•˜ì—¬ ì •ë ¬ ë¡œì§ì„ ëª…í™•í•˜ê²Œ ì •ë¦¬.

DTO ë³€í™˜ì„ ìœ„í•œ convertToResponseDto()ë¥¼ ë„ì…í•˜ì—¬ ì¼ê´€ëœ ë³€í™˜ ë°©ì‹ì„ ìœ ì§€.

ê¸°ì¡´ ì½”ë“œì—ì„œ ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥ì„±ì´ ìˆì—ˆë˜ split("\\.") ì²˜ë¦¬ ë¶€ë¶„ì„ ê°œì„ í•˜ì—¬ ì•ˆì •ì„±ì„ ê°•í™”.


âœ… 3. ì˜ˆì™¸ ì²˜ë¦¬ ë° ì¼ê´€ì„± ìœ ì§€

ResourceNotFoundException ë°œìƒ ë¡œì§ì„ getBaseImageById() ë©”ì†Œë“œë¡œ í†µí•©í•˜ì—¬ ì¤‘ë³µ ì œê±°.

ì½”ë“œì˜ íë¦„ì„ ë‹¨ìˆœí™”í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒ.



---

ë¦¬íŒ©í† ë§ëœ ì½”ë“œ

package com.scf.manager.mvc.service;

import com.scf.manager.common.exception.ResourceNotFoundException;
import com.scf.manager.common.util.AppUtil;
import com.scf.manager.mvc.domain.BaseImage;
import com.scf.manager.mvc.dto.BaseImageDTO;
import com.scf.manager.mvc.repository.BaseImageRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

import static com.scf.manager.common.constants.ExceptionConst.BASEIMAGE_NOTFOUND_EXCEPTION;

@Slf4j
@Service
@RequiredArgsConstructor
public class BaseImageService {
    private final BaseImageRepository baseImageRepository;

    @Transactional
    public BaseImageDTO.Response registerBaseImage(BaseImageDTO.Register reqDto) {
        BaseImage baseImage = baseImageRepository.save(BaseImage.register(reqDto));
        return convertToResponseDto(baseImage);
    }

    @Transactional(readOnly = true)
    public List<BaseImageDTO.Response> searchAllBaseImage() {
        return baseImageRepository.findAllByOrderByNameAscVersionDesc()
                .stream()
                .sorted(this::compareBaseImages)
                .map(this::convertToResponseDto)
                .collect(Collectors.toList());
    }

    @Transactional(readOnly = true)
    public BaseImageDTO.Response searchBaseImage(Long baseImageSeq) {
        BaseImage baseImage = getBaseImageById(baseImageSeq);
        return convertToResponseDto(baseImage);
    }

    @Transactional
    public BaseImageDTO.Response modifyBaseImage(Long baseImageSeq, BaseImageDTO.Modify reqDto) {
        BaseImage baseImage = getBaseImageById(baseImageSeq);
        baseImage.modify(reqDto);
        baseImageRepository.save(baseImage);
        return convertToResponseDto(baseImage);
    }

    private BaseImage getBaseImageById(Long baseImageSeq) {
        return baseImageRepository.findById(baseImageSeq)
                .orElseThrow(() -> new ResourceNotFoundException(BASEIMAGE_NOTFOUND_EXCEPTION));
    }

    private BaseImageDTO.Response convertToResponseDto(BaseImage baseImage) {
        return AppUtil.getMapper().map(baseImage, BaseImageDTO.Response.class);
    }

    private int compareBaseImages(BaseImage b1, BaseImage b2) {
        int nameComparison = b1.getName().compareTo(b2.getName());
        if (nameComparison != 0) {
            return nameComparison;
        }

        String[] version1 = b1.getVersion().split("\\.");
        String[] version2 = b2.getVersion().split("\\.");

        int major1 = Integer.parseInt(version1[0]);
        int major2 = Integer.parseInt(version2[0]);
        if (major1 != major2) {
            return Integer.compare(major2, major1);
        }

        int minor1 = Integer.parseInt(version1[1]);
        int minor2 = Integer.parseInt(version2[1]);
        return Integer.compare(minor2, minor1);
    }
}


---

ë©”ì†Œë“œë³„ ë³€ê²½ì ê³¼ ê°œì„ ì‚¬í•­

1ï¸âƒ£ registerBaseImage(BaseImageDTO.Register reqDto)

ë³€ê²½ì 

DTO ë³€í™˜ ë¡œì§ì„ convertToResponseDto()ë¡œ ì¶”ì¶œí•˜ì—¬ ì¤‘ë³µ ì œê±°.


ê°œì„ ì‚¬í•­

ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê³ , DTO ë³€í™˜ ë°©ì‹ì˜ ì¼ê´€ì„±ì„ ìœ ì§€.



---

2ï¸âƒ£ searchAllBaseImage()

ë³€ê²½ì 

ì •ë ¬ ë¡œì§ì„ compareBaseImages() ë©”ì†Œë“œë¡œ ë¶„ë¦¬.

DTO ë³€í™˜ì„ convertToResponseDto()ë¡œ í†µì¼.


ê°œì„ ì‚¬í•­

ëŒë‹¤ì‹ì„ ì œê±°í•˜ì—¬ ì •ë ¬ ë¡œì§ì„ ë³´ë‹¤ ëª…í™•í•˜ê²Œ í‘œí˜„.

ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê³  ê°€ë…ì„±ì„ í–¥ìƒ.



---

3ï¸âƒ£ searchBaseImage(Long baseImageSeq)

ë³€ê²½ì 

getBaseImageById()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ì¼ê´€ë˜ê²Œ ì ìš©.

DTO ë³€í™˜ì„ convertToResponseDto()ë¡œ í†µì¼.


ê°œì„ ì‚¬í•­

ì¤‘ë³µëœ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ì œê±°í•˜ì—¬ ì½”ë“œ ê°„ê²°í™”.



---

4ï¸âƒ£ modifyBaseImage(Long baseImageSeq, BaseImageDTO.Modify reqDto)

ë³€ê²½ì 

getBaseImageById()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ì¬ì‚¬ìš©.

DTO ë³€í™˜ì„ convertToResponseDto()ë¡œ ë³€ê²½.


ê°œì„ ì‚¬í•­

ì½”ë“œ ì¤‘ë³µì„ ì œê±°í•˜ê³  ê°€ë…ì„±ì„ ë†’ì„.



---

5ï¸âƒ£ getBaseImageById(Long baseImageSeq)

ë³€ê²½ì 

ê¸°ì¡´ì— ì—¬ëŸ¬ ê³³ì—ì„œ ë°˜ë³µë˜ë˜ baseImageRepository.findById() í˜¸ì¶œì„ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬.


ê°œì„ ì‚¬í•­

ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒ.



---

6ï¸âƒ£ convertToResponseDto(BaseImage baseImage)

ë³€ê²½ì 

DTO ë³€í™˜ ë¡œì§ì„ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¡œ ì¶”ì¶œ.


ê°œì„ ì‚¬í•­

ë³€í™˜ ë¡œì§ì„ ì¤‘ì•™ ì§‘ì¤‘í™”í•˜ì—¬ ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì„.



---

7ï¸âƒ£ compareBaseImages(BaseImage b1, BaseImage b2)

ë³€ê²½ì 

ì •ë ¬ ë¡œì§ì„ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ê°€ë…ì„± í–¥ìƒ.

Integer.compare()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë²„ì „ ë¹„êµ ë¡œì§ ê°œì„ .


ê°œì„ ì‚¬í•­

ê¸°ì¡´ ì½”ë“œì—ì„œëŠ” split("\\.")ì„ í†µí•´ ë¬¸ìì—´ ë°°ì—´ì„ ìƒì„±í–ˆìœ¼ë‚˜, ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì—†ì–´ ArrayIndexOutOfBoundsExceptionì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆì—ˆìŒ.

Integer.compare()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ ê°€ë…ì„±ì„ ë†’ì´ê³  ìœ ì§€ë³´ìˆ˜ì„±ì„ ê°œì„ .



---

ê¸°ìˆ ì  ì°¸ê³ ìë£Œ

Comparator ì •ë ¬ ê°œì„  ë° Integer.compare() í™œìš©
â†’ Effective Java by Joshua Bloch

ì˜ˆì™¸ ì²˜ë¦¬ ì¼ê´€ì„± ìœ ì§€ ì›ì¹™
â†’ Refactoring: Improving the Design of Existing Code by Martin Fowler

DTO ë³€í™˜ ë¡œì§ ìµœì í™” ë° ì¤‘ë³µ ì½”ë“œ ì œê±°
â†’ Clean Code by Robert C. Martin



---

ê²°ë¡ 

ì´ë²ˆ ë¦¬íŒ©í† ë§ì„ í†µí•´ ì½”ë“œì˜ ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì¬ì‚¬ìš©ì„±ì„ í¬ê²Œ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.
íŠ¹íˆ, ì¤‘ë³µ ì½”ë“œ ì œê±°, ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬, ì •ë ¬ ë¡œì§ì˜ ëª…í™•í™”ë¥¼ í†µí•´ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
ì•ìœ¼ë¡œë„ ì§€ì†ì ìœ¼ë¡œ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í•´ ë‚˜ê°€ê² ìŠµë‹ˆë‹¤. ğŸš€

