ğŸ“Œ [PR ê°œìš”]

ğŸ”¹ ë¦¬íŒ©í† ë§: FunctionLogService ì½”ë“œ ê°œì„  ë° í´ë¦° ì½”ë“œ ì ìš©

ì´ë²ˆ PRì—ì„œëŠ” FunctionLogService í´ë˜ìŠ¤ì˜ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í•˜ê³ , ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë¦¬íŒ©í† ë§ ë° í´ë¦° ì½”ë“œ ì ìš©ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.
ì£¼ìš” ê°œì„  ì‚¬í•­ìœ¼ë¡œëŠ” ì¤‘ë³µ ì½”ë“œ ì œê±°, ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”, JSON ë°ì´í„° ì²˜ë¦¬ ìµœì í™”, ê°€ë…ì„± í–¥ìƒ, ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP) ì ìš©ì´ í¬í•¨ë©ë‹ˆë‹¤.


---

ğŸ“Œ [ê°œë°œ ë‚´ìš©]

âœ… ì£¼ìš” ê°œì„  ì‚¬í•­

1. ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ë©”ì†Œë“œ ë¶„ë¦¬

JSON ë°ì´í„° ì¶”ì¶œ ë¡œì§ì„ extractLogData() ë° extractPodList() ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP)ì„ ì ìš©.

HTTP ì—°ê²° ì„¤ì •ì„ establishLetheConnection() ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ì¬ì‚¬ìš©ì„±ì„ ì¦ê°€.



2. ê°€ë…ì„± í–¥ìƒì„ ìœ„í•œ ë¦¬íŒ©í† ë§

StringBuilder ëŒ€ì‹  String.format()ì„ í™œìš©í•˜ì—¬ ê°€ë…ì„±ì„ ê°œì„ .

retrieveRawJSON() ë©”ì†Œë“œì—ì„œ Collectors.joining()ì„ ì‚¬ìš©í•˜ì—¬ ë” ê°„ê²°í•œ ì½”ë“œ êµ¬í˜„.



3. ëª…í™•í•œ ì˜ˆì™¸ ì²˜ë¦¬ ë° ë¡œê¹… ê°œì„ 

HTTP_OKê°€ ì•„ë‹ ê²½ìš° IOExceptionì„ ë°œìƒì‹œí‚¤ë„ë¡ ë³€ê²½í•˜ì—¬ ì˜ˆì™¸ ìƒí™©ì„ ëª…í™•í•˜ê²Œ ì²˜ë¦¬.

IllegalArgumentExceptionì„ í™œìš©í•˜ì—¬ ë” ëª…í™•í•œ ì˜ˆì™¸ ë©”ì‹œì§€ ì œê³µ.



4. í•˜ë“œì½”ë”©ëœ ë¬¸ìì—´ ìƒìˆ˜í™”

"user-container", "status", "resultType" ë“±ì˜ ë¬¸ìì—´ì„ ìƒìˆ˜í™”í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒ.

QUERY_FORMATì„ String.format()ì„ í™œìš©í•˜ì—¬ ë³´ë‹¤ ê°€ë…ì„± ë†’ì€ ì¿¼ë¦¬ ìƒì„± ë°©ì‹ ì ìš©.





---

ğŸ“Œ [ë©”ì†Œë“œë³„ ë³€ê²½ì  ë° ê°œì„  ì‚¬í•­]

1ï¸âƒ£ makeLogQueryString()

ğŸ’¡ ê°œì„  ì „ ë¬¸ì œì :

pod == null || pod.isEmpty()ë¥¼ ì²´í¬í•˜ëŠ” if-else êµ¬ë¬¸ì´ ê°€ë…ì„±ì„ ì €í•˜ì‹œí‚´.

StringBuilder ëŒ€ì‹  String.format()ì„ ì‚¬ìš©í•˜ë©´ ë” ì§ê´€ì ì¸ ì½”ë“œë¡œ ë³€í™˜ ê°€ëŠ¥.


ğŸ’¡ ê°œì„  í›„ ë³€ê²½ ì‚¬í•­:

String.format()ì„ í™œìš©í•˜ì—¬ ë” ì§ê´€ì ì¸ ì¿¼ë¦¬ ë¬¸ìì—´ ìƒì„± ë°©ì‹ ì ìš©.

Integer.parseInt(time)ì„ í™œìš©í•˜ì—¬ Calendar ê³„ì‚° ì‹œ "-" ë¬¸ìì—´ ì—°ì‚°ì„ ì œê±°í•˜ê³  ê°€ë…ì„± í–¥ìƒ.


âœ… ê°œì„  í›„ ì½”ë“œ:

private String makeLogQueryString(String functionKey, String time, String pod) {
    Function function = functionRepository.findByFunctionKey(functionKey)
            .orElseThrow(() -> new IllegalArgumentException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í‘ì…˜ì…ë‹ˆë‹¤."));

    String functionName = (pod == null || pod.isEmpty()) ? function.getName().concat(".*") : pod;

    long queryEndTime = System.currentTimeMillis() / 1000L; // í˜„ì¬ ì‹œê° íƒ€ì„ìŠ¤íƒ¬í”„
    long queryStartTime = (System.currentTimeMillis() - (Integer.parseInt(time) * 3600L * 1000L)) / 1000L; // time ì‹œê°„ ì „ íƒ€ì„ìŠ¤íƒ¬í”„ ê³„ì‚°

    return String.format(QUERY_FORMAT, function.getName(), functionName, queryStartTime, queryEndTime);
}

ğŸ“Œ ê°œì„  íš¨ê³¼:

ê°€ë…ì„± í–¥ìƒ: StringBuilder ëŒ€ì‹  String.format()ì„ ì‚¬ìš©í•˜ì—¬ ë” ê¹”ë”í•œ ì½”ë“œë¡œ ë³€í™˜.

ë¶ˆí•„ìš”í•œ Calendar ê°ì²´ ì œê±°: System.currentTimeMillis()ë¥¼ ì§ì ‘ í™œìš©í•˜ì—¬ ì½”ë“œ ë‹¨ìˆœí™”.



---

2ï¸âƒ£ getLetheLogData()

ğŸ’¡ ê°œì„  ì „ ë¬¸ì œì :

HTTP_OKê°€ ì•„ë‹ ê²½ìš° nullì„ ë°˜í™˜í•˜ëŠ” ë°©ì‹ â†’ ì˜ˆì™¸ ë°œìƒ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ.


ğŸ’¡ ê°œì„  í›„ ë³€ê²½ ì‚¬í•­:

HTTP_OKê°€ ì•„ë‹ ê²½ìš° IOExceptionì„ ë˜ì ¸ì„œ ì—ëŸ¬ ë°œìƒ ì‹œ ì›ì¸ì„ ëª…í™•íˆ ì•Œ ìˆ˜ ìˆë„ë¡ ë³€ê²½.


âœ… ê°œì„  í›„ ì½”ë“œ:

private String getLetheLogData(String query) throws IOException {
    HttpURLConnection connection = establishLetheConnection(query);

    if (connection.getResponseCode() != HttpURLConnection.HTTP_OK) {
        throw new IOException("Lethe ë¡œê·¸ ìš”ì²­ ì‹¤íŒ¨: HTTP ìƒíƒœ ì½”ë“œ " + connection.getResponseCode());
    }

    String jsonResponse = retrieveRawJSON(connection);
    return extractInformationFromRawJSON(jsonResponse);
}

ğŸ“Œ ê°œì„  íš¨ê³¼:

ì˜ˆì™¸ ìƒí™©ì„ ëª…í™•í•˜ê²Œ ì²˜ë¦¬í•˜ì—¬ ë¬¸ì œ ë°œìƒ ì‹œ ë””ë²„ê¹…ì´ ì‰¬ì›Œì§.

HTTP ìƒíƒœ ì½”ë“œ í™•ì¸ í›„ ì˜ˆì™¸ ì²˜ë¦¬ ì ìš© â†’ nullì„ ë°˜í™˜í•˜ëŠ” ë°©ì‹ ëŒ€ì‹ , ì ì ˆí•œ ì˜ˆì™¸ë¥¼ ë˜ì ¸ ë””ë²„ê¹… ê°€ëŠ¥.



---

3ï¸âƒ£ retrieveRawJSON()

ğŸ’¡ ê°œì„  ì „ ë¬¸ì œì :

StringBuffer ëŒ€ì‹  ë©€í‹°ìŠ¤ë ˆë”©ì´ í•„ìš” ì—†ëŠ” í™˜ê²½ì—ì„œëŠ” StringBuilderê°€ ì„±ëŠ¥ì´ ë” ì¢‹ìŒ.

BufferedReaderì˜ ë°ì´í„°ë¥¼ ë” ì§ê´€ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì¡´ì¬.


ğŸ’¡ ê°œì„  í›„ ë³€ê²½ ì‚¬í•­:

Collectors.joining()ì„ í™œìš©í•˜ì—¬ ë” ê°„ê²°í•œ ì½”ë“œë¡œ ë³€í™˜.


âœ… ê°œì„  í›„ ì½”ë“œ:

private String retrieveRawJSON(HttpURLConnection connection) throws IOException {
    try (BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(connection.getInputStream()))) {
        return bufferedReader.lines().collect(Collectors.joining());
    }
}

ğŸ“Œ ê°œì„  íš¨ê³¼:

ë¶ˆí•„ìš”í•œ while ë£¨í”„ ì œê±° â†’ Collectors.joining()ì„ í™œìš©í•˜ì—¬ ë” ê°„ê²°í•œ ì½”ë“œë¡œ ë³€ê²½.

try-with-resources ì ìš© â†’ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ë¥¼ ë°©ì§€.



---

4ï¸âƒ£ extractInformationFromRawJSON()

ğŸ’¡ ê°œì„  ì „ ë¬¸ì œì :

JSON ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ í•˜ë‚˜ì˜ ë©”ì†Œë“œì—ì„œ ë„ˆë¬´ ë§ì€ ì—­í• ì„ ìˆ˜í–‰.

"time"ê³¼ "log" í‚¤ë§Œ ì¶”ì¶œí•˜ëŠ” ë¶€ë¶„ì„ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•¨.


ğŸ’¡ ê°œì„  í›„ ë³€ê²½ ì‚¬í•­:

extractLogData() ë° extractPodList() ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì—¬ ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP) ì ìš©.


âœ… ê°œì„  í›„ ì½”ë“œ:

private String extractInformationFromRawJSON(String jsonResponse) {
    JSONObject jsonObject = new JSONObject(jsonResponse);
    JSONObject dataObject = jsonObject.getJSONObject("data");
    JSONArray resultArray = dataObject.getJSONArray("result");

    JSONArray extractedArray = extractLogData(resultArray);
    List<String> podList = extractPodList(resultArray);

    JSONObject extractedJson = new JSONObject();
    extractedJson.put("status", jsonObject.getString("status"));
    extractedJson.put("data", new JSONObject()
            .put("resultType", dataObject.getString("resultType"))
            .put("pods", podList)
            .put("result", extractedArray));

    return extractedJson.toString();
}

ğŸ“Œ ê°œì„  íš¨ê³¼:

ê° ì—­í• ì„ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œ ê°€ë…ì„± í–¥ìƒ.

ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP) ì ìš©.



---

ğŸ“Œ [ê²°ë¡ ]

ì´ PRì„ í†µí•´ ì½”ë“œ ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì˜ˆì™¸ ì²˜ë¦¬, ì¤‘ë³µ ì½”ë“œ ì œê±° ë“±ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤.
ğŸ“ ì£¼ìš” ê°œì„  íš¨ê³¼:
âœ… ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ì±…ì„ ë¶„ë¦¬ â†’ extractLogData(), extractPodList() ë¶„ë¦¬
âœ… ê°€ë…ì„± í–¥ìƒ â†’ String.format()ì„ í™œìš©í•˜ì—¬ ê°€ë…ì„±ì„ ê°œì„ 
âœ… ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™” â†’ IOExceptionì„ í™œìš©í•˜ì—¬ ì˜¤ë¥˜ ë°œìƒ ì‹œ ëª…í™•í•œ ë©”ì‹œì§€ ì œê³µ
âœ… ë¶ˆí•„ìš”í•œ ê°ì²´ ì œê±° â†’ System.currentTimeMillis()ë¥¼ í™œìš©í•˜ì—¬ ì½”ë“œ ë‹¨ìˆœí™”

ì´ì œ ë” ì§ê´€ì ì´ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ì½”ë“œ êµ¬ì¡°ë¥¼ ê°–ì¶”ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš€âœ¨

