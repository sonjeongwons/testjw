ì—ëŸ¬ì˜ í•µì‹¬ ì›ì¸ì€ ì•„ë˜ ë¡œê·¸ë¡œë¶€í„° ëª…í™•íˆ ë“œëŸ¬ë‚©ë‹ˆë‹¤:

com.google.gson.stream.MalformedJsonException: Use JsonReader.setStrictness(Strictness.LENIENT) to accept malformed JSON at line 2 column 2 path $

ì¦‰, AppUtil.JSONStringPrettyPrinter(...)ì—ì„œ GSONì„ ì‚¬ìš©í•˜ì—¬ JSONì„ íŒŒì‹±í•˜ë ¤ê³  ì‹œë„í•˜ëŠ”ë°, í•´ë‹¹ ë¬¸ìì—´ì´ ì •ìƒì ì¸ JSON í˜•ì‹ì´ ì•„ë‹˜ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ í˜¸ì¶œì€ ì•„ë˜ ìœ„ì¹˜ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤:

log.info("HTTP Request / Body: \n {}", AppUtil.JSONStringPrettyPrinter(bodyContent));

ì´ ì—ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:


---

âœ… ì›ì¸ ë¶„ì„

1. bodyContentê°€ JSONì´ ì•„ë‹Œ ê²½ìš°

String bodyContent = body != null ? new String(body, StandardCharsets.UTF_8) : "null";

ì´ bodyëŠ” ë©€í‹°íŒŒíŠ¸ ìš”ì²­ì´ë¯€ë¡œ application/json í˜•ì‹ì´ ì•„ë‹Œ boundaryë¥¼ í¬í•¨í•œ binary ë°ì´í„°ì…ë‹ˆë‹¤.

ì˜ˆ: ì•„ë˜ì™€ ê°™ì´ ì‹œì‘í•¨

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="test.jar"
Content-Type: application/java-archive
...

ì¦‰, JSONì´ ì•„ë‹ˆë¯€ë¡œ Gson.fromJson() ì‹œë„ â†’ MalformedJsonException í„°ì§



---

âœ… í•´ê²° ë°©ì•ˆ

ğŸ”§ 1. AppUtil.JSONStringPrettyPrinter() í˜¸ì¶œ ì¡°ê±´ ìˆ˜ì • (ë©€í‹°íŒŒíŠ¸ì¼ ê²½ìš° ì œì™¸)

// HttpCallService.setRestClientWithLogging() ë‚´ë¶€
String contentType = request.getHeaders().getContentType() != null ? request.getHeaders().getContentType().toString() : "";

if (contentType.contains("application/json")) {
    try {
        String bodyContent = body != null ? new String(body, StandardCharsets.UTF_8) : "null";
        log.info("HTTP Request / Body: \n {}", AppUtil.JSONStringPrettyPrinter(bodyContent));
    } catch (Exception e) {
        log.warn("Body íŒŒì‹± ì‹¤íŒ¨ (JSONì´ ì•„ë‹ ìˆ˜ ìˆìŒ): {}", e.getMessage());
    }
} else {
    log.info("Content-Typeì´ JSONì´ ì•„ë‹ˆë¯€ë¡œ body ë¡œê¹… ìƒëµ (Content-Type: {})", contentType);
}

ğŸ“Œ ì¶”ê°€ë¡œ AppUtil.java ë‚´ì— ì •ì˜ëœ JSONStringPrettyPrinter()ê°€ ë‹¤ìŒì²˜ëŸ¼ ë˜ì–´ ìˆë‹¤ë©´:

public static String JSONStringPrettyPrinter(String json) {
    Gson gson = new GsonBuilder().setPrettyPrinting().create();
    JsonElement je = JsonParser.parseString(json); // ì—¬ê¸°ì„œ ì—ëŸ¬ ë°œìƒ
    return gson.toJson(je);
}

ì´ í•¨ìˆ˜ ìì²´ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë°©ì–´ì ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

public static String JSONStringPrettyPrinter(String json) {
    try {
        Gson gson = new GsonBuilder().setPrettyPrinting().create();
        JsonElement je = JsonParser.parseString(json);
        return gson.toJson(je);
    } catch (Exception e) {
        return json; // JSONì´ ì•„ë‹ˆë©´ ê·¸ëƒ¥ ì›ë³¸ ë¦¬í„´
    }
}


---

âœ¨ ê¶ê·¹ì ì¸ í•´ê²° ìš”ì•½

ìœ„ì¹˜	ìˆ˜ì • í¬ì¸íŠ¸	ì„¤ëª…

HttpCallService#setRestClientWithLogging()	Content-Typeì´ application/jsonì¼ ë•Œë§Œ AppUtil.JSONStringPrettyPrinter í˜¸ì¶œ	ë©€í‹°íŒŒíŠ¸ëŠ” JSONì´ ì•„ë‹˜
AppUtil.JSONStringPrettyPrinter()	ì˜ˆì™¸ ì²˜ë¦¬ ì¶”ê°€	íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë¬¸ ê·¸ëŒ€ë¡œ ë¦¬í„´



---

âœ… ë³´ë„ˆìŠ¤: ê°œì„  ê¶Œì¥ ì‚¬í•­

1. @Value("${CVC.URL}")ëŠ” static ë³€ìˆ˜ì— ì‚¬ìš© âŒ

@Value("${CVC.URL}")
private static String CVC_URL;  // âŒ Springì´ ì£¼ì…í•˜ì§€ ëª»í•¨

Springì—ì„œëŠ” @Valueê°€ non-static í•„ë“œì—ë§Œ ì£¼ì…ë˜ë¯€ë¡œ, ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì•¼ í•¨:

@Value("${CVC.URL}")
private String cvcUrl;  // í•„ë“œëª…ì„ ì†Œë¬¸ìë¡œ ë°”ê¾¸ëŠ” ê²ƒë„ ì»¨ë²¤ì…˜ìƒ ì¶”ì²œ

private String getCvcEndpoint() {
    return cvcUrl + "/api/v1/scanner/multipart-scan";
}

ê·¸ë¦¬ê³  scanCodeFile() ì•ˆì—ì„œëŠ” static ì œê±°í•˜ê³  ì¸ìŠ¤í„´ìŠ¤ ë©”ì†Œë“œë¡œ ìœ ì§€:

String endpoint = getCvcEndpoint();


---

âœ… ì „ì²´ì ìœ¼ë¡œ ë³´ë©´, ì½”ë“œì˜ ì£¼ìš” ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤

êµ¬ë¶„	ë¬¸ì œ	í•´ê²°

GSON íŒŒì‹± ì‹¤íŒ¨	multipart/form-dataë¥¼ JSONìœ¼ë¡œ íŒŒì‹± ì‹œë„	Content-Type í™•ì¸ í›„ JSONë§Œ pretty print
@Value ì£¼ì… ì‹¤íŒ¨	static í•„ë“œì— @Value ì‚¬ìš©	non-staticìœ¼ë¡œ ë³€ê²½
ì—ëŸ¬ ë¡œê·¸ ê°€ë…ì„±	GSON ì˜¤ë¥˜ë¡œ stack trace ê¸¸ì–´ì§	ì—ëŸ¬ ë°œìƒ ì‹œ graceful fallback ì²˜ë¦¬



---

ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

Q1: AppUtil.JSONStringPrettyPrinterì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¥¼ ë§‰ê¸° ìœ„í•œ ê°€ì¥ ì ì ˆí•œ ìœ íš¨ì„± ì²´í¬ ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œ?

Q2: ë©€í‹°íŒŒíŠ¸ ìš”ì²­/ì‘ë‹µì„ ë¡œê¹…í•  ë•Œ ë°ì´í„° ë…¸ì¶œì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë¡œê¹… ì „ëµì€ ì–´ë–»ê²Œ êµ¬ì„±í•´ì•¼ í• ê¹Œ?

Q3: GSONì„ í™œìš©í•œ JSON pretty print ëŒ€ì‹  ObjectMapperë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì¥ë‹¨ì ì€ ë¬´ì—‡ì¼ê¹Œ?

