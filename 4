GitHub PR ì½”ë“œ ë¦¬ë·° ì½”ë©˜íŠ¸

íŒ€ì›ì˜ ë©‹ì§„ ë¦¬íŒ©í† ë§ PRì„ ë³´ë©´ì„œ ëª‡ ê°€ì§€ ê°œì„ ì ê³¼ ì¶”ê°€ ë…¼ì˜í•´ë³¼ ë¶€ë¶„ì„ ë‚¨ê²¨ë³¼ê²Œìš”! ğŸ˜Š
ì´ë²ˆ PRì—ì„œ ë§ì€ ì½”ë“œ í’ˆì§ˆ í–¥ìƒì´ ìˆì—ˆê³ , ëª‡ ê°€ì§€ ì‘ì€ ê°œì„ ì´ ë”í•´ì§€ë©´ ë”ìš± ê¹”ë”í•œ ì½”ë“œê°€ ë  ê²ƒ ê°™ì•„! ğŸš€
ì½”ë©˜íŠ¸ ëª‡ ê°œ ë‚¨ê¸¸ê²Œ! ğŸ™Œ


---

1. getTriggerByType() - ì¤‘ë³µ ì œê±° & ë” ë‚˜ì€ ë°ì´í„° êµ¬ì¡° í™œìš© ì œì•ˆ

ğŸ”¹ ë¦¬ë·° ë‚´ìš©:
í˜„ì¬ getTriggerByType()ì—ì„œ switch-caseë¥¼ ì‚¬ìš©í•´ì„œ TriggerHTTP, TriggerCron, TriggerAPIGWë¥¼ ì¡°íšŒí•˜ê³  ìˆì–´!
ì´ ë°©ì‹ë„ ì¢‹ì§€ë§Œ, Mapì„ í™œìš©í•˜ë©´ ë” ê¹”ë”í•˜ê²Œ ë¦¬íŒ©í† ë§í•  ìˆ˜ë„ ìˆì–´!

ì˜ˆì œ ì½”ë“œ ì œì•ˆ:

private static final Map<TriggerTypeEnum, Function<Trigger, Optional<?>>> triggerRepositoryMap = Map.of(
    TriggerTypeEnum.HTTP, triggerHTTPRepository::findByTrigger,
    TriggerTypeEnum.CRON, triggerCronRepository::findByTrigger,
    TriggerTypeEnum.APIGATEWAY, triggerAPIGWRepository::findByTrigger
);

private void getTriggerByType(Trigger trigger, TriggerHTTP triggerHTTP, TriggerCron triggerCron, TriggerAPIGW triggerAPIGW) {
    Optional<?> result = triggerRepositoryMap.getOrDefault(
        TriggerTypeEnum.valueOf(trigger.getTriggerType().toUpperCase()),
        t -> Optional.empty()
    ).apply(trigger);

    if (result.isEmpty()) {
        throw new ResourceNotFoundException("ìœ íš¨í•œ íŠ¸ë¦¬ê±°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
}

âœ… ì´ë ‡ê²Œ í•˜ë©´ switch-case ì—†ì´ Mapì„ í†µí•´ ì¡°íšŒí•  ìˆ˜ ìˆì–´ì„œ ì½”ë“œì˜ ê°€ë…ì„±ì´ ë” ì¢‹ì•„ì§€ê³ , ìƒˆë¡œìš´ íŠ¸ë¦¬ê±° íƒ€ì…ì´ ì¶”ê°€ë  ë•Œ OCP(Open-Closed Principle) ë¥¼ ì§€í‚¬ ìˆ˜ ìˆì–´! ğŸ˜ƒ
ğŸ’¡ ë¬¼ë¡  ì§€ê¸ˆ ë°©ì‹ë„ ì¶©ë¶„íˆ ì¢‹ì§€ë§Œ, í•œ ë²ˆ ê³ ë ¤í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„!


---

2. validateTriggerType() - ì˜ˆì™¸ ì²˜ë¦¬ ë” ëª…í™•í•˜ê²Œ í•˜ê¸°

ğŸ”¹ ë¦¬ë·° ë‚´ìš©:
í˜„ì¬ validateTriggerType()ì—ì„œ StringUtils.isEmpty(triggerType)ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ê³  ìˆì–´!
ì—¬ê¸°ì„œ í•œ ê°€ì§€ ê°œì„  í¬ì¸íŠ¸ê°€ ìˆì–´!

1ï¸âƒ£ í˜„ì¬ TriggerTypeEnumì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë‹ˆ, ìœ íš¨í•œ íƒ€ì…ì¸ì§€ë„ Enumìœ¼ë¡œ ê²€ì¦í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„.
2ï¸âƒ£ IllegalArgumentExceptionì„ ì‚¬ìš©í•˜ë©´ ë” ì ì ˆí•œ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•  ê²ƒ ê°™ì•„.

ğŸ’¡ ì˜ˆì œ ì½”ë“œ ì œì•ˆ:

private void validateTriggerType(String triggerType) {
    if (StringUtils.isEmpty(triggerType)) {
        throw new IllegalArgumentException(ExceptionMessages.TRIGGER_TYPE_REQUIRED);
    }

    try {
        TriggerTypeEnum.valueOf(triggerType.toUpperCase());
    } catch (IllegalArgumentException e) {
        throw new IllegalArgumentException("ì˜ëª»ëœ íŠ¸ë¦¬ê±° íƒ€ì…ì…ë‹ˆë‹¤: " + triggerType);
    }
}

âœ… ì´ë ‡ê²Œ í•˜ë©´ ì˜ëª»ëœ íŠ¸ë¦¬ê±° íƒ€ì…ì„ Enumì—ì„œ í•œ ë²ˆ ë” ê²€ì¦í•´ì¤˜ì„œ ì‚¬ì „ì— ì˜¤ë¥˜ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆì–´!
ğŸ”¹ ì§€ê¸ˆ ì½”ë“œë„ ê´œì°®ì§€ë§Œ, ì˜ˆì™¸ë¥¼ ë” êµ¬ì²´ì ìœ¼ë¡œ ë‹¤ë£¨ë©´ ë””ë²„ê¹…í•  ë•Œë„ í›¨ì”¬ ì¢‹ì„ ê²ƒ ê°™ì•„!


---

3. modifyTrigger() - ë¶ˆí•„ìš”í•œ deleteTrigger() í˜¸ì¶œ ë°©ì§€

ğŸ”¹ ë¦¬ë·° ë‚´ìš©:
í˜„ì¬ modifyTrigger()ì—ì„œëŠ” ê¸°ì¡´ íŠ¸ë¦¬ê±°ë¥¼ ì‚­ì œí•œ í›„ ìƒˆë¡œìš´ íŠ¸ë¦¬ê±°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆì–´.
í•˜ì§€ë§Œ íŠ¸ë¦¬ê±°ê°€ ë³€ê²½ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë„ ê¸°ì¡´ íŠ¸ë¦¬ê±°ë¥¼ ì‚­ì œí•˜ëŠ” ë¡œì§ì´ ì‹¤í–‰ë  ê°€ëŠ¥ì„±ì´ ìˆì–´!

âœ… í•œ ë²ˆ ì´ëŸ° ë¡œì§ìœ¼ë¡œ ê°œì„ í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œ?

public TriggerDTO.Response modifyTrigger(TriggerDTO.Modify reqDto, String functionKey) throws IOException, ParseException {
    validateTriggerType(reqDto.getTriggerType());

    Function function = getFunctionOrThrow(functionKey);
    Trigger existingTrigger = getTriggerOrThrow(function);

    // ğŸš€ ë³€ê²½ëœ ê²½ìš°ë§Œ ì‚­ì œ & ì¬ë“±ë¡!
    if (!existingTrigger.getTriggerType().equals(reqDto.getTriggerType())) {
        deleteTrigger(function, false);
        return updateTrigger(reqDto, function);
    }
    
    return existingTrigger.toDto(function, new TriggerHTTP(), new TriggerCron(), new TriggerAPIGW(), false);
}

âœ… ì´ë ‡ê²Œ í•˜ë©´ ë¶ˆí•„ìš”í•œ ì‚­ì œ ì—°ì‚°ì´ ì¤„ì–´ë“¤ê³ , ì„±ëŠ¥ ìµœì í™”ì—ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´! ğŸš€
ğŸ’¡ ì§€ê¸ˆ ë°©ì‹ë„ ì˜ ë™ì‘í•˜ì§€ë§Œ, íŠ¸ë¦¬ê±°ê°€ ë³€ê²½ë˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ë¶ˆí•„ìš”í•œ ì—°ì‚°ì„ ë°©ì§€í•˜ëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ì•„!


---

4. connectTrigger() - ì¤‘ë³µ ë¡œì§ ì œê±° & validateTriggerConnection() í™œìš© ê°œì„ 

ğŸ”¹ ë¦¬ë·° ë‚´ìš©:
í˜„ì¬ connectTrigger()ì—ì„œ validateTriggerConnection()ì„ í˜¸ì¶œí•œ í›„ì—ë„ ë³„ë„ë¡œ triggerAPIGWë¥¼ ì €ì¥í•˜ëŠ” ë¡œì§ì´ ì¶”ê°€ë˜ì–´ ìˆì–´!
ğŸš€ validateTriggerConnection()ì„ í†µí•´ "apigateway"ê°€ ì•„ë‹ˆë¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë„ë¡ í•˜ê³ , ì´í›„ì˜ ë¶„ê¸°ë¬¸ì„ ì¤„ì´ë©´ ê°€ë…ì„±ì´ ë” ì¢‹ì•„ì§ˆ ê²ƒ ê°™ì•„!

ê°œì„ ëœ ì½”ë“œ ì˜ˆì‹œ:

public TriggerDTO.Response connectTrigger(TriggerDTO.Modify reqDto, String functionKey) throws IOException, ParseException {
    Function function = getFunctionOrThrow(functionKey);
    Trigger trigger = getTriggerOrThrow(function);

    validateTriggerConnection(trigger);

    TriggerAPIGW triggerAPIGW = triggerAPIGWRepository.save(TriggerAPIGW.register(reqDto));

    trigger.updateTriggerConnectedYn("Y");
    triggerRepository.save(trigger);

    return trigger.toDto(function, new TriggerHTTP(), new TriggerCron(), triggerAPIGW, true);
}

private void validateTriggerConnection(Trigger trigger) {
    if ("Y".equals(trigger.getTriggerConnectedYn())) {
        throw new IllegalStateException(ExceptionMessages.TRIGGER_ALREADY_CONNECTED);
    }

    if (!TriggerTypeEnum.APIGATEWAY.name().equals(trigger.getTriggerType())) {
        throw new IllegalArgumentException(ExceptionMessages.TRIGGER_TYPE_MISMATCH);
    }
}

âœ… ì´ë ‡ê²Œ í•˜ë©´

validateTriggerConnection()ì„ í™œìš©í•˜ì—¬ ì˜ëª»ëœ íŠ¸ë¦¬ê±° ì—°ê²°ì„ ì‚¬ì „ì— ë°©ì§€

IllegalStateExceptionê³¼ IllegalArgumentExceptionì„ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ì˜ ì˜ë¯¸ë¥¼ ëª…í™•íˆ í•¨

connectTrigger() ë‚´ ë¶ˆí•„ìš”í•œ if-else ë¶„ê¸°ë¬¸ ì œê±°ë¡œ ê°€ë…ì„± í–¥ìƒ


ğŸ’¡ ì§€ê¸ˆ ë°©ì‹ë„ ì¢‹ì§€ë§Œ, ë¶„ê¸°ë¥¼ ì¤„ì´ë©´ ë” ëª…í™•í•œ ë¡œì§ì´ ë  ê²ƒ ê°™ì•„!


---

ë§ˆë¬´ë¦¬ ğŸ‰

ğŸ‘ ì´ë²ˆ ë¦¬íŒ©í† ë§ PR ì •ë§ ì˜í–ˆì–´!
íŠ¹íˆ Magic String ì œê±°, ì˜ˆì™¸ ë©”ì‹œì§€ í†µí•©, Guard Clause ì ìš©, Enum í™œìš© ë¶€ë¶„ì´ ë„ˆë¬´ ì¢‹ì•˜ì–´!
ëª‡ ê°€ì§€ ë” ê°œì„ í•˜ë©´ ë” ê¹”ë”í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì¢‹ì€ ì½”ë“œê°€ ë  ê²ƒ ê°™ì•„ì„œ ì½”ë©˜íŠ¸ ë‚¨ê²¼ì–´! ğŸ˜ƒ

âœ… ìš”ì•½ 1ï¸âƒ£ getTriggerByType() â†’ Map í™œìš©í•˜ì—¬ ë” ìœ ì—°í•˜ê²Œ ë¦¬íŒ©í† ë§ ê°€ëŠ¥
2ï¸âƒ£ validateTriggerType() â†’ Enum í™œìš©í•˜ì—¬ ì˜ëª»ëœ íŠ¸ë¦¬ê±° íƒ€ì… ê²€ì¦
3ï¸âƒ£ modifyTrigger() â†’ íŠ¸ë¦¬ê±° ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ì‚­ì œ ë¡œì§ ìƒëµ ê°€ëŠ¥
4ï¸âƒ£ connectTrigger() â†’ ì¤‘ë³µ ì œê±°í•˜ê³  ì˜ˆì™¸ë¥¼ ëª…í™•í•˜ê²Œ ì²˜ë¦¬

ğŸš€ íŒ€ì›ë“¤ì´ë‘ë„ ë…¼ì˜í•´ë³´ê³ , ì ìš©í•´ë³¼ ìˆ˜ ìˆìœ¼ë©´ ê°™ì´ ê°œì„ í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„!
ğŸ’¡ ì½”ë“œ ë„ˆë¬´ ì¢‹ê³ , ëª‡ ê°€ì§€ ë””í…Œì¼ë§Œ ë‹¤ë“¬ìœ¼ë©´ ì™„ë²½í•  ê²ƒ ê°™ì•„! ì •ë§ ìˆ˜ê³ í–ˆì–´! ğŸ‘

