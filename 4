PR 2: ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„  ë° ì„œë¹„ìŠ¤ ê³„ì¸µ ì •ë¦¬
ğŸ”¹ ì£¼ìš” ë³€ê²½ ì‚¬í•­
ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬ ì ìš©
RuntimeException â†’ ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì ìš© (FunctionAlreadyExistsException, InvalidFunctionRequestException ë“±)
ResourceNotFoundExceptionì„ í†µí•©í•˜ì—¬ ë” ì˜ë¯¸ ìˆëŠ” ì˜ˆì™¸ ë©”ì‹œì§€ ì œê³µ
ë°˜í™˜ íƒ€ì… ë³€ê²½ ë° Optional ì²˜ë¦¬ ê°œì„ 
Optional.orElseThrow()ë¥¼ í™œìš©í•´ ë¶ˆí•„ìš”í•œ isPresent() ê²€ì‚¬ ì œê±°
ë°˜í™˜ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì •ì˜ (null ë°˜í™˜ ì œê±°)
ìƒìˆ˜ê°’ ë° Magic String ì œê±°
functionStatus, "N" ë“± í•˜ë“œì½”ë”©ëœ ê°’ ì œê±° â†’ ëª…í™•í•œ ìƒìˆ˜ ì‚¬ìš©
ë¡œê¹… ë° ì˜ˆì™¸ ë°œìƒ ì‹œ ë©”ì‹œì§€ ì •ë¦¬
log.error()ë¥¼ í†µí•œ ì˜ˆì™¸ ìƒì„¸ ì •ë³´ ê¸°ë¡ ì¶”ê°€
ğŸ“Œ ë³€ê²½ëœ ë©”ì†Œë“œ ìƒì„¸ ì„¤ëª…
1ï¸âƒ£ registerFunction ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ 
ğŸ”¹ ë³€ê²½ ì „ ë¬¸ì œì 
ì˜ˆì™¸ ë©”ì‹œì§€ê°€ ë¶ˆëª…í™•í•˜ì—¬ ë””ë²„ê¹… ì–´ë ¤ì›€
RuntimeExceptionì„ ì§ì ‘ ì‚¬ìš© â†’ ì˜ˆì™¸ì˜ ëª…í™•ì„±ì´ ë¶€ì¡±
í•˜ë“œì½”ë”©ëœ "N" ê°’ì´ ì—¬ëŸ¬ êµ°ë°ì—ì„œ ì‚¬ìš©ë¨
âœ… ë³€ê²½ í›„ ê°œì„ ì 
ì»¤ìŠ¤í…€ ì˜ˆì™¸ (FunctionAlreadyExistsException, InvalidFunctionRequestException) ì ìš©
FunctionStatus.NOT_READY.getKey()ë¥¼ FunctionStatus.NOT_READYë¡œ ì§ì ‘ ì‚¬ìš©
functionRepository.findByFunctionKeyAndDelYnì„ Optional.orElseThrow()ë¡œ ë³€ê²½
ğŸ“Œ ë³€ê²½ í›„ ì½”ë“œ
java
ë³µì‚¬
í¸ì§‘
@Transactional
public FunctionDTO.Response registerFunction(FunctionDTO.Register reqDto) throws IOException, ParseException {
    validateFunctionRequest(reqDto);

    if (isFunctionExists(reqDto.getFunctionKey(), reqDto.getDisplayName(), reqDto.getProjectId())) {
        throw new FunctionAlreadyExistsException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í‘ì…˜ í‚¤ ë˜ëŠ” í‘ì…˜ëª…ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.");
    }

    reqDto.setName(generateFunctionName());
    reqDto.setFunctionStatus(TypeEnums.FunctionStatus.NOT_READY);

    if (!reqDto.getRuntime().startsWith("Java")) {
        reqDto.setContent(generateBaseCode(reqDto));
    }

    Function function = functionRepository.save(Function.register(reqDto));
    initializeFunction(function, reqDto);

    return function.toDto();
}
ğŸ“Œ ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤ ì¶”ê°€
java
ë³µì‚¬
í¸ì§‘
public class FunctionAlreadyExistsException extends RuntimeException {
    public FunctionAlreadyExistsException(String message) {
        super(message);
    }
}
java
ë³µì‚¬
í¸ì§‘
public class InvalidFunctionRequestException extends RuntimeException {
    public InvalidFunctionRequestException(String message) {
        super(message);
    }
}
2ï¸âƒ£ registerFunctionCode ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ 
ğŸ”¹ ë³€ê²½ ì „ ë¬¸ì œì 
findByFunctionKey í˜¸ì¶œ í›„ ì§ì ‘ if (function == null) ë°©ì‹ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬
RuntimeExceptionì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ì˜ë¯¸ê°€ ë¶ˆë¶„ëª…
í•¨ìˆ˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ í•˜ë“œì½”ë”©ëœ ê°’ ì‚¬ìš©
âœ… ë³€ê²½ í›„ ê°œì„ ì 
findByFunctionKeyë¥¼ Optional.orElseThrow()ë¡œ ë³€ê²½
FunctionNotFoundExceptionì„ í™œìš©í•œ ì˜ë¯¸ ìˆëŠ” ì˜ˆì™¸ ë©”ì‹œì§€ ì œê³µ
TypeEnums.FunctionStatus.DEPLOYINGë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ê°€ë…ì„± í–¥ìƒ
ğŸ“Œ ë³€ê²½ í›„ ì½”ë“œ
java
ë³µì‚¬
í¸ì§‘
@Transactional
public FunctionDTO.Response registerFunctionCode(FunctionDTO.Register reqDto, String functionKey) throws IOException, ParseException {
    Function function = functionRepository.findByFunctionKey(functionKey)
            .orElseThrow(() -> new FunctionNotFoundException("í‘ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. FunctionKey: " + functionKey));

    function.updateContent(reqDto.getContent());

    if (shouldDeployFunction(function)) {
        deployFunction(function);
    }

    return function.toDto();
}
ğŸ“Œ FunctionNotFoundException í´ë˜ìŠ¤ ì¶”ê°€
java
ë³µì‚¬
í¸ì§‘
public class FunctionNotFoundException extends RuntimeException {
    public FunctionNotFoundException(String message) {
        super(message);
    }
}
3ï¸âƒ£ searchFunction ë°˜í™˜ê°’ ë° ì˜ˆì™¸ ì²˜ë¦¬ ê°œì„ 
ğŸ”¹ ë³€ê²½ ì „ ë¬¸ì œì 
nullì„ ë°˜í™˜í•  ê°€ëŠ¥ì„±ì´ ìˆì–´, í˜¸ì¶œí•˜ëŠ” ì¸¡ì—ì„œ NPE ë°œìƒ ê°€ëŠ¥
findByFunctionKey í›„ orElseThrow()ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ì˜ˆì™¸ê°€ ë°œìƒí•  ê²½ìš° ì¶”ì  ì–´ë ¤ì›€
íŠ¸ë¦¬ê±°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œ, ResourceNotFoundException ë°œìƒ â†’ ì ì ˆí•œ ê¸°ë³¸ê°’ ë°˜í™˜ì´ í•„ìš”
âœ… ë³€ê²½ í›„ ê°œì„ ì 
Optional.orElseThrow()ë¥¼ í™œìš©í•˜ì—¬ ëª…í™•í•œ ì˜ˆì™¸ ì²˜ë¦¬
íŠ¸ë¦¬ê±°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
ì¼ê´€ëœ FunctionNotFoundException ì‚¬ìš©
ğŸ“Œ ë³€ê²½ í›„ ì½”ë“œ
java
ë³µì‚¬
í¸ì§‘
@Transactional(readOnly = true)
public FunctionDTO.Response searchFunction(String functionKey) {
    Function function = functionRepository.findByFunctionKey(functionKey)
            .orElseThrow(() -> new FunctionNotFoundException("í‘ì…˜ ì•„ì´ë””ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. FunctionKey: " + functionKey));

    FunctionDTO.Response output = AppUtil.getMapper().map(function, FunctionDTO.Response.class);
    output.setEndPointUrls(UrlUtil.generateUrl(function.getName(), function.getRegion(), "none"));

    Trigger trigger = triggerRepository.findByFunction(function).orElse(null);
    if (trigger != null) {
        output.setTriggerType(trigger.getTriggerType());
        output.setTriggerConnectedYn(trigger.getTriggerConnectedYn());
    } else {
        output.setTriggerType("unknown");
        output.setTriggerConnectedYn("N");
    }

    return output;
}
ğŸ“Œ PR 2 - ì „ì²´ ë³€ê²½ ì½”ë“œ
PR2ì—ì„œ ë³€ê²½ëœ ë¶€ë¶„ì„ ë°˜ì˜í•œ ì „ì²´ ì½”ë“œë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.

1ë²ˆ í¸ì§‘í•¨

ëŒ€ì‹  ì±„íŒ…ì—ì„œ ë‹µí•©ë‹ˆë‹¤
ğŸ”¹ PR 2 ìš”ì•½
âœ… ì¼ê´€ëœ ì˜ˆì™¸ ì²˜ë¦¬ ì ìš© (ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì‚¬ìš©)
âœ… Optional ì²˜ë¦¬ ê°œì„  (orElseThrow() í™œìš©)
âœ… ë¶ˆí•„ìš”í•œ null ë°˜í™˜ ì œê±° â†’ NPE ì˜ˆë°©
âœ… Magic String ë° í•˜ë“œì½”ë”©ëœ ê°’ ì œê±°
âœ… ë¡œê¹…ì„ í†µí•œ ë””ë²„ê¹… ë° ê°€ë…ì„± í–¥ìƒ

ì´ì œ PR 3ì—ì„œëŠ” ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„± ì œê±° ë° ì„±ëŠ¥ ìµœì í™”ë¥¼ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤. ğŸš€
PR 3ë¥¼ ì§„í–‰í• ê¹Œìš”?
