Pull Request (PR) ê°œìš”

PR ì œëª©

ğŸ”§ Refactor TriggerService for Better Maintainability, Readability, and Performance


---

PR ê°œìš”

ì´ë²ˆ PRì—ì„œëŠ” TriggerService í´ë˜ìŠ¤ì˜ ì½”ë“œ í’ˆì§ˆì„ í–¥ìƒí•˜ê¸° ìœ„í•´ í´ë¦° ì½”ë“œ ì›ì¹™ê³¼ SOLID ì›ì¹™ì„ ì ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
ì´ ê³¼ì •ì—ì„œ ì¤‘ë³µ ì½”ë“œ ì œê±°, Magic String ì œê±°, ì˜ˆì™¸ ë©”ì‹œì§€ ìƒìˆ˜í™”, Guard Clause ì ìš©, Enum í™œìš©, ë©”ì„œë“œ ì—­í•  ë¶„ë¦¬ ë“±ì„ í†µí•´ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.


---

ê°œë°œ ë‚´ìš©

1. ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ë©”ì„œë“œ ì¶”ì¶œ

íŠ¸ë¦¬ê±° íƒ€ì…ì— ë”°ë¥¸ ì¡°íšŒ ë¡œì§ ì¤‘ë³µ ì œê±°
â†’ getTriggerByType(Trigger trigger, TriggerHTTP triggerHTTP, TriggerCron triggerCron, TriggerAPIGW triggerAPIGW)

íŠ¸ë¦¬ê±° ì—°ê²° ì—¬ë¶€ ê²€ì¦ ë¡œì§ ì¤‘ë³µ ì œê±°
â†’ validateTriggerConnection(Trigger trigger)

íŠ¸ë¦¬ê±° íƒ€ì… ê²€ì¦ ë¡œì§ ì¤‘ë³µ ì œê±°
â†’ validateTriggerType(String triggerType)

í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±° ì¡°íšŒ ì¤‘ë³µ ì œê±°
â†’ getFunctionOrThrow(String functionKey), getTriggerOrThrow(Function function)


2. Magic String ì œê±° ë° Enum í™œìš©

ê¸°ì¡´ if-else ë¬¸ì—ì„œ íŠ¸ë¦¬ê±° íƒ€ì…ì„ ë¹„êµí•  ë•Œ ë¬¸ìì—´ì„ ì§ì ‘ ì‚¬ìš©
â†’ TriggerTypeEnum ìƒì„±í•˜ì—¬ íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥
â†’ TriggerTypeEnum.valueOf(trigger.getTriggerType().toUpperCase()) í˜•íƒœë¡œ ë³€ê²½í•˜ì—¬ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ


3. ì˜ˆì™¸ ë©”ì‹œì§€ ìƒìˆ˜í™” (ExceptionMessages ì¶”ê°€)

í•˜ë“œì½”ë”©ëœ ë¬¸ìì—´ ê¸°ë°˜ ì˜ˆì™¸ ë©”ì‹œì§€ ì œê±°
â†’ ExceptionMessages í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì˜ˆì™¸ ë©”ì‹œì§€ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬
â†’ ì˜ˆì™¸ ë°œìƒ ì‹œ ì¼ê´€ëœ ë©”ì‹œì§€ë¥¼ ì œê³µí•˜ë©°, ìœ ì§€ë³´ìˆ˜ ì‹œ ìˆ˜ì •ì´ ìš©ì´


4. Guard Clause ì ìš© (ë¶ˆí•„ìš”í•œ if-else ì œê±°)

ì¡°ê¸° ë°˜í™˜(Early Return) ì ìš©í•˜ì—¬ ì½”ë“œ ì¤‘ì²© ìµœì†Œí™”

modifyTrigger(), connectTrigger() ë“±ì—ì„œ if-else ì¤‘ì²©ì„ ì¤„ì´ê³  ëª…í™•í•œ íë¦„ì„ ìœ ì§€



5. ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„± ì œê±°

searchTrigger(), connectTrigger() ë“±ì—ì„œ í•„ìš”í•˜ì§€ ì•Šì€ ê°ì²´ ì´ˆê¸°í™”(new TriggerHTTP(), new TriggerCron(), new TriggerAPIGW())
â†’ ì‹¤ì œ ì¡°íšŒ ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ë„ë¡ ë³€ê²½í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê°ì²´ ìƒì„± ë°©ì§€



---

ë©”ì„œë“œë³„ ë³€ê²½ì  ë° ê°œì„  ì‚¬í•­

1. searchTrigger(String functionKey)

ë³€ê²½ ì‚¬í•­

getTriggerByType() ë©”ì„œë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ íŠ¸ë¦¬ê±° ì¡°íšŒ ë¡œì§ ì¤‘ë³µ ì œê±°

Magic String ì œê±° (Trigger íƒ€ì…ì„ ë¬¸ìì—´ì´ ì•„ë‹Œ TriggerTypeEnumìœ¼ë¡œ ê´€ë¦¬)

ì˜ˆì™¸ ë©”ì‹œì§€ë¥¼ ìƒìˆ˜í™” (ExceptionMessages í™œìš©)


public TriggerDTO.Response searchTrigger(String functionKey) {
    Function function = getFunctionOrThrow(functionKey);
    Trigger trigger = getTriggerOrThrow(function);

    TriggerHTTP triggerHTTP = new TriggerHTTP();
    TriggerCron triggerCron = new TriggerCron();
    TriggerAPIGW triggerAPIGW = new TriggerAPIGW();

    getTriggerByType(trigger, triggerHTTP, triggerCron, triggerAPIGW);

    return trigger.toDto(function, triggerHTTP, triggerCron, triggerAPIGW, false);
}

ê°œì„ ëœ ì 

ì½”ë“œ ê°€ë…ì„± í–¥ìƒ: getTriggerByType() ë©”ì„œë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ í•œ ëˆˆì— ë³´ê¸° ì‰½ë„ë¡ ê°œì„ 

ì¤‘ë³µ ì œê±°: íŠ¸ë¦¬ê±° ì¡°íšŒ ë¡œì§ì„ ë©”ì„œë“œë¡œ ì¶”ì¶œí•˜ì—¬ ì½”ë“œ ì¬ì‚¬ìš©ì„± ì¦ê°€



---

2. modifyTrigger(TriggerDTO.Modify reqDto, String functionKey)

ë³€ê²½ ì‚¬í•­

ì¤‘ë³µëœ íŠ¸ë¦¬ê±° íƒ€ì… ê²€ì¦ ë¡œì§ì„ validateTriggerType()ìœ¼ë¡œ ì¶”ì¶œ

ë¶ˆí•„ìš”í•œ ê°ì²´ ì´ˆê¸°í™” ì œê±°

ì¡°ê¸° ë°˜í™˜ ì ìš© (Guard Clause)


public TriggerDTO.Response modifyTrigger(TriggerDTO.Modify reqDto, String functionKey) throws IOException, ParseException {
    validateTriggerType(reqDto.getTriggerType());

    Function function = getFunctionOrThrow(functionKey);
    deleteTrigger(function, false);

    return updateTrigger(reqDto, function);
}

private void validateTriggerType(String triggerType) {
    if (StringUtils.isEmpty(triggerType)) {
        throw new RuntimeException(ExceptionMessages.TRIGGER_TYPE_REQUIRED);
    }
}

ê°œì„ ëœ ì 

ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ: íŠ¸ë¦¬ê±° íƒ€ì… ê²€ì¦ ë¡œì§ì´ ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©ë˜ë¯€ë¡œ ë³„ë„ ë©”ì„œë“œë¡œ ë¶„ë¦¬

Guard Clause ì ìš©: ë¶ˆí•„ìš”í•œ if-else ì œê±°í•˜ì—¬ ì½”ë“œ íë¦„ì´ ë‹¨ìˆœí•´ì§



---

3. connectTrigger(TriggerDTO.Modify reqDto, String functionKey)

ë³€ê²½ ì‚¬í•­

íŠ¸ë¦¬ê±° ì—°ê²° ì—¬ë¶€ ê²€ì¦ ë¡œì§ì„ validateTriggerConnection()ìœ¼ë¡œ ë¶„ë¦¬

Enum í™œìš© (Magic String ì œê±°)


public TriggerDTO.Response connectTrigger(TriggerDTO.Modify reqDto, String functionKey) throws IOException, ParseException {
    Function function = getFunctionOrThrow(functionKey);
    Trigger trigger = getTriggerOrThrow(function);

    validateTriggerConnection(trigger);

    TriggerAPIGW triggerAPIGW = triggerAPIGWRepository.save(TriggerAPIGW.register(reqDto));

    trigger.updateTriggerConnectedYn("Y");
    triggerRepository.save(trigger);

    return trigger.toDto(function, new TriggerHTTP(), new TriggerCron(), triggerAPIGW, true);
}

private void validateTriggerConnection(Trigger trigger) {
    if ("Y".equals(trigger.getTriggerConnectedYn())) {
        throw new RuntimeException(ExceptionMessages.TRIGGER_ALREADY_CONNECTED);
    }
    if (!TriggerTypeEnum.APIGATEWAY.name().equals(trigger.getTriggerType())) {
        throw new RuntimeException(ExceptionMessages.TRIGGER_TYPE_MISMATCH);
    }
}

ê°œì„ ëœ ì 

ì¤‘ë³µ ì œê±°: íŠ¸ë¦¬ê±° ì—°ê²° ê²€ì¦ ë¡œì§ì„ ë©”ì„œë“œë¡œ ë¶„ë¦¬í•˜ì—¬ ì¬ì‚¬ìš© ê°€ëŠ¥

Magic String ì œê±°: TriggerTypeEnum.APIGATEWAY.name()ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì… ë¹„êµ



---

ê¸°ìˆ ì  ê·¼ê±° ë° ì¶œì²˜

1. Magic String ì œê±° ë° Enum ì‚¬ìš©

Enumì„ ì‚¬ìš©í•˜ë©´ ì»´íŒŒì¼ íƒ€ì„ ì•ˆì „ì„±ì„ í™•ë³´í•˜ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ í•¨ (Joshua Bloch, Effective Java)



2. Guard Clause ì ìš©

Guard Clauseë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œì˜ ê°€ë…ì„±ì´ í–¥ìƒë˜ë©°, ë¶ˆí•„ìš”í•œ ì¤‘ì²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŒ (Martin Fowler, Refactoring)



3. ì˜ˆì™¸ ë©”ì‹œì§€ ìƒìˆ˜í™”

ì˜ˆì™¸ ë©”ì‹œì§€ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ë©´ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›Œì§ (Robert C. Martin, Clean Code)





---

PR ìŠ¹ì¸ í›„ ê¸°ëŒ€ íš¨ê³¼

ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ: ì¤‘ë³µ ì œê±°, Guard Clause ì ìš©, Enum ì‚¬ìš©

ë²„ê·¸ ë°œìƒ ê°€ëŠ¥ì„± ê°ì†Œ: Magic String ì œê±°ë¡œ ì¸í•´ ì˜¤íƒ€ë¡œ ì¸í•œ ì˜¤ë¥˜ ë°©ì§€

ê°œë°œ ìƒì‚°ì„± ì¦ê°€: validateTriggerType(), validateTriggerConnection() ë“± ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ ë„ì…



---

ë¦¬ë·° ìš”ì²­ ì‚¬í•­

Enumì„ í™œìš©í•œ Magic String ì œê±°ê°€ ì ì ˆí•œì§€ ê²€í†  í•„ìš”

ExceptionMessagesë¥¼ í™œìš©í•œ ì˜ˆì™¸ ë©”ì‹œì§€ í†µí•©ì´ ì ì ˆí•œ ë°©ì‹ì¸ì§€ í™•ì¸ í•„ìš”

Guard Clause ì ìš©ìœ¼ë¡œ ì½”ë“œ íë¦„ì´ ëª…í™•í•´ì¡ŒëŠ”ì§€ ê²€í†  ìš”ì²­



---

ë§ˆë¬´ë¦¬

ì´ë²ˆ ë¦¬íŒ©í† ë§ì„ í†µí•´ ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ê°€ë…ì„±ì„ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.
ë¦¬ë·° ë¶€íƒë“œë¦½ë‹ˆë‹¤! ğŸš€

