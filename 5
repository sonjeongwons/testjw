현재 발생한 문제는 Nginx에서 Lua 모듈을 로드하려고 시도할 때, resty.lrucache 모듈이 누락되었기 때문에 발생한 것입니다. 또한 Nginx의 PID 파일이 없어서 -s 옵션 명령이 작동하지 않는 문제도 함께 나타나고 있습니다.

문제 원인
resty.lrucache 모듈 누락:

resty.lrucache는 OpenResty Lua 모듈의 필수 구성 요소 중 하나입니다.
lua-resty-core 모듈이 제대로 작동하려면 이 의존성이 설치되어 있어야 합니다.
Nginx PID 파일 누락:

/var/run/nginx.pid 파일이 없거나 Nginx가 실행 중이지 않아서 PID 파일이 생성되지 않은 상태입니다.
PID 파일은 Nginx의 상태 관리 명령(-s stop, -s reload 등)에 필요합니다.
해결 방법
1. resty.lrucache 모듈 설치
resty.lrucache 모듈을 설치하여 Lua 모듈의 의존성을 해결합니다.

LuaRocks를 사용한 설치
LuaRocks 설치 확인:

bash
복사
편집
yum install -y luarocks
lua-resty-lrucache 설치:

bash
복사
편집
luarocks install lua-resty-lrucache
GitHub에서 직접 설치
resty.lrucache 소스 코드 다운로드:

bash
복사
편집
cd /usr/local/src
git clone https://github.com/openresty/lua-resty-lrucache.git
설치:

bash
복사
편집
cp -r lua-resty-lrucache/lib/resty /usr/local/share/lua/5.1/
2. Nginx PID 파일 문제 해결
(1) Nginx가 실행 중인지 확인
Nginx가 실행 중인지 확인합니다:

bash
복사
편집
ps aux | grep nginx
실행 중이 아니라면 Nginx를 시작합니다:
bash
복사
편집
nginx
(2) PID 파일 생성 확인
PID 파일 경로(/var/run/nginx.pid)가 설정되어 있는지 확인합니다:

bash
복사
편집
grep pid /etc/nginx/nginx.conf
출력이 다음과 같아야 합니다:

plaintext
복사
편집
pid /var/run/nginx.pid;
(3) PID 파일 경로 수동 생성
PID 파일이 누락된 경우 다음 명령을 실행하여 생성합니다:

bash
복사
편집
echo $$ > /var/run/nginx.pid
Nginx를 다시 실행하여 PID 파일이 정상적으로 생성되는지 확인합니다:

bash
복사
편집
nginx -t
nginx
3. Lua 경로 재설정
Lua 모듈 경로를 Nginx가 올바르게 참조할 수 있도록 설정합니다.

LUA_PATH와 LUA_CPATH 환경 변수 설정:

bash
복사
편집
export LUA_PATH='/usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;;'
export LUA_CPATH='/usr/local/lib/lua/5.1/?.so;;'
영구 적용을 위해 ~/.bashrc에 추가:

bash
복사
편집
echo 'export LUA_PATH="/usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;;"' >> ~/.bashrc
echo 'export LUA_CPATH="/usr/local/lib/lua/5.1/?.so;;"' >> ~/.bashrc
source ~/.bashrc
LuaJIT 테스트:

bash
복사
편집
luajit -e 'require("resty.lrucache")'
오류가 없다면 설치가 성공적으로 완료된 것입니다.

4. Nginx 재시작 및 테스트
Nginx를 다시 시작합니다:

bash
복사
편집
nginx -s stop
nginx
설정 파일 테스트:

bash
복사
편집
nginx -t
Lua 설정 테스트:

bash
복사
편집
curl http://localhost/lua_test
결론
문제 요약
resty.lrucache 모듈이 설치되어 있지 않음.
Nginx PID 파일이 없거나 생성되지 않아 Nginx 상태 관리 명령(-s)이 작동하지 않음.
해결 요약
resty.lrucache를 LuaRocks 또는 GitHub에서 설치.
Nginx PID 파일 생성 및 경로 설정 확인.
Lua 경로(LUA_PATH, LUA_CPATH)를 올바르게 설정.
Q1. Nginx가 시작 시 PID 파일을 생성하지 못하는 원인을 어떻게 디버깅할 수 있을까?

Q2. LuaRocks 대신 직접 설치한 Lua 모듈의 관리 방법은 무엇인가?

Q3. Nginx와 OpenResty 모듈 충돌 없이 Lua 모듈을 사용하는 최적의 방법은 무엇인가?
