
Nginx 컴파일 중 ngx_http_lua_module 설정에서 LuaJIT 버전이 지원되지 않는다는 에러가 발생한 원인은 다음과 같습니다:

원인 분석
LuaJIT 경로 지정 문제:

Nginx ./configure 스크립트는 환경 변수를 통해 LuaJIT의 라이브러리 경로와 헤더 파일 경로를 탐색합니다.
기본적으로 /usr/local/lib와 /usr/local/include/luajit-2.1에서 LuaJIT 파일을 찾지만, 경로를 정확히 설정하지 않았거나 올바른 위치에 설치되지 않았을 가능성이 있습니다.
LuaJIT 버전 확인 문제:

LuaJIT 버전이 Nginx의 ngx_http_lua_module에서 요구하는 2.x 버전에 맞지 않을 수 있습니다. 하지만 로그에 따르면 LuaJIT 2.1.1737090214를 성공적으로 설치했으므로 경로 문제일 가능성이 높습니다.
환경 변수 설정 누락:

LUAJIT_LIB와 LUAJIT_INC 환경 변수가 설정되지 않아, ./configure 스크립트가 LuaJIT 파일을 찾지 못한 것으로 보입니다.
해결 방법
1. 환경 변수 설정
LuaJIT 경로를 명시적으로 설정하여 Nginx가 올바른 경로를 인식하도록 합니다.

bash
복사
편집
export LUAJIT_LIB=/usr/local/lib
export LUAJIT_INC=/usr/local/include/luajit-2.1
2. ./configure 명령에 경로 추가
환경 변수로 LuaJIT 경로를 설정한 뒤, 다시 ./configure 명령을 실행합니다:

bash
복사
편집
./configure \
    --prefix=/etc/nginx \
    --sbin-path=/usr/sbin/nginx \
    --conf-path=/etc/nginx/nginx.conf \
    --error-log-path=/var/log/nginx/error.log \
    --http-log-path=/var/log/nginx/access.log \
    --pid-path=/var/run/nginx.pid \
    --lock-path=/var/run/nginx.lock \
    --with-http_ssl_module \
    --with-http_stub_status_module \
    --with-http_gzip_static_module \
    --with-pcre \
    --add-module=/usr/local/src/ngx_devel_kit \
    --add-module=/usr/local/src/lua-nginx-module \
    --with-ld-opt="-Wl,-rpath,/usr/local/lib"
--with-ld-opt="-Wl,-rpath,/usr/local/lib" 옵션은 LuaJIT 라이브러리를 실행 시 동적으로 연결할 수 있도록 설정합니다.

3. LuaJIT 경로 확인
LuaJIT이 올바르게 설치되었는지 다시 확인합니다.

bash
복사
편집
ls -l /usr/local/lib/libluajit-5.1.so*
ls -l /usr/local/include/luajit-2.1/
결과로 .so 파일과 헤더 파일이 있어야 합니다:

/usr/local/lib/libluajit-5.1.so
/usr/local/include/luajit-2.1/lua.h 등
4. 의존성 설치 확인
만약 위 설정 이후에도 동일한 에러가 발생한다면, Nginx가 사용하는 컴파일러가 LuaJIT 관련 의존성을 찾지 못하는 경우일 수 있습니다. 이 경우 pkg-config를 통해 의존성을 다시 확인합니다.

bash
복사
편집
sudo yum install -y pkgconfig
pkg-config --modversion luajit
luajit의 버전이 올바르게 출력되지 않으면 LuaJIT 설치 경로를 다시 확인해야 합니다.

5. 재시도
설정을 수정한 후, 다시 ./configure 명령을 실행해보세요. 문제가 해결되었을 가능성이 높습니다.

추가 조언
OpenResty 사용 고려: Lua 모듈과 LuaJIT을 쉽게 통합하려면 OpenResty를 사용하는 것이 더 편리할 수 있습니다. OpenResty는 ngx_http_lua_module과 LuaJIT을 기본적으로 포함합니다.

로그 확인: config.log 파일을 열어 unsupported LuaJIT version 에러와 관련된 세부 로그를 확인하면 더 구체적인 원인을 파악할 수 있습니다.

