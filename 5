아래는 docker image의 태그에서 "scr-dev.comm.scp-in.com" 도메인을 "paas-dssqlxhe.scr.skr-west.scp-in.com"으로 바꾸는 쉘 스크립트야. 기존 이미지의 태그를 새로운 태그로 변경하고, 원하면 푸시까지 할 수 있게 구성했어.

#!/bin/bash

OLD_REGISTRY="scr-dev.comm.scp-in.com"
NEW_REGISTRY="paas-dssqlxhe.scr.skr-west.scp-in.com"

# grep 대상 이미지를 리스트로 가져오기
docker image ls --format '{{.Repository}}:{{.Tag}}' | grep "$OLD_REGISTRY" | while read IMAGE; do
  # 새 태그 구성
  NEW_IMAGE=$(echo "$IMAGE" | sed "s|$OLD_REGISTRY|$NEW_REGISTRY|")

  echo "Retagging $IMAGE -> $NEW_IMAGE"

  # 태그 변경
  docker tag "$IMAGE" "$NEW_IMAGE"

  # 주석 해제하면 레지스트리로 푸시 가능
  # docker push "$NEW_IMAGE"
done

사용법

1. 위 내용을 retag-images.sh로 저장


2. 실행 권한 부여: chmod +x retag-images.sh


3. 실행: ./retag-images.sh



참고

docker push는 주석 처리되어 있으니, 실제로 새 레지스트리로 푸시하려면 주석을 해제해야 해.

원한다면 기존 태그 삭제 (docker rmi)도 스크립트에 추가 가능해.



---

Q1: 새로 태그된 이미지를 기존 레지스트리에 푸시하려면 인증은 어떻게 처리하는 게 가장 안전할까?
Q2: 이미지 레이어 캐싱을 고려할 때 새로운 레지스트리에 동일 이미지를 푸시할 경우 중복 저장은 어떻게 방지되나?
Q3: 레지스트리 간 이미지 미러링 자동화는 어떤 방식이 효율적일까? (예: crane, skopeo, GitHub Action)

