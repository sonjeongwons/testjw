ì½”ë“œ ë¦¬ë·° ì½”ë©˜íŠ¸ ëª©ë¡ (PR ì½”ë©˜íŠ¸ ì˜ˆì‹œ)


---

1ï¸âƒ£ registerBaseImage() - DTO ë³€í™˜ ë°©ì‹ ê´€ë ¨

ğŸ’¬ "ì™€! ì½”ë“œê°€ í›¨ì”¬ ê¹”ë”í•´ì¡Œë„¤ìš”. convertToResponseDto()ë¥¼ í™œìš©í•´ì„œ DTO ë³€í™˜ì„ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•œ ì ì´ ë„ˆë¬´ ì¢‹ìŠµë‹ˆë‹¤! ğŸ‘ ë‹¤ë§Œ, ìš”ì¦˜ Springì—ì„œ MapStruct ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ”ë°, í˜¹ì‹œ ì ìš©ì„ ê³ ë ¤í•´ë³¼ê¹Œìš”?"

ğŸ’¡ ì œì•ˆ:
Springì—ì„œ MapStructë¥¼ ì‚¬ìš©í•˜ë©´ DTO ë³€í™˜ì„ ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ì„œ ì½”ë“œê°€ ë” ê°„ê²°í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
ì˜ˆë¥¼ ë“¤ì–´, BaseImageMapper í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ì•„ë˜ì²˜ëŸ¼ ë³€í™˜ì„ ìë™í™”í•  ìˆ˜ë„ ìˆì–´ìš”.

@Mapper(componentModel = "spring")
public interface BaseImageMapper {
    BaseImageDTO.Response toResponseDto(BaseImage baseImage);
}

ê·¸ëŸ¼ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì—ì„œëŠ” ì´ë ‡ê²Œ ë” ê°„ê²°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê² ì£ !

private final BaseImageMapper baseImageMapper;

@Transactional
public BaseImageDTO.Response registerBaseImage(BaseImageDTO.Register reqDto) {
    BaseImage baseImage = baseImageRepository.save(BaseImage.register(reqDto));
    return baseImageMapper.toResponseDto(baseImage);
}

ì§€ê¸ˆë„ ì¶©ë¶„íˆ ì¢‹ì€ë°, DTO ë³€í™˜ì„ ë” ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´ í•œ ë²ˆ ê³ ë ¤í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”! ğŸ˜Š


---

2ï¸âƒ£ searchAllBaseImage() - ì •ë ¬ ë¡œì§ ê°œì„ 

ğŸ’¬ "ì •ë ¬ ë¡œì§ì„ compareBaseImages()ë¡œ ë¶„ë¦¬í•œ ì ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤! ì½”ë“œê°€ í•œëˆˆì— ì´í•´ë˜ë„¤ìš”. ë‹¤ë§Œ, Java 8+ì—ì„œëŠ” Comparator.comparing()ì„ í™œìš©í•˜ë©´ ì¡°ê¸ˆ ë” ê°„ê²°í•˜ê²Œ ì •ë ¬í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ì•„ìš”. í•œ ë²ˆ ì°¸ê³ í•´ë³´ì„¸ìš”!"

ğŸ’¡ ì œì•ˆ:
í˜„ì¬ compareBaseImages()ëŠ” ì§ì ‘ ë¬¸ìì—´ì„ ë¹„êµí•˜ê³  Integer.parseInt()ë¥¼ ì‚¬ìš©í•´ ìˆ«ì ë¹„êµë¥¼ í•˜ê³  ìˆëŠ”ë°,
Comparator.comparing()ì„ í™œìš©í•˜ë©´ ë” ê¹”ë”í•˜ê²Œ ì •ë ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

private Comparator<BaseImage> baseImageComparator = Comparator
    .comparing(BaseImage::getName)
    .thenComparing((b) -> Integer.parseInt(b.getVersion().split("\\.")[0]), Comparator.reverseOrder())
    .thenComparing((b) -> Integer.parseInt(b.getVersion().split("\\.")[1]), Comparator.reverseOrder());

ê·¸ëŸ¼ searchAllBaseImage()ì—ì„œëŠ” ì´ë ‡ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”!

@Transactional(readOnly = true)
public List<BaseImageDTO.Response> searchAllBaseImage() {
    return baseImageRepository.findAllByOrderByNameAscVersionDesc()
            .stream()
            .sorted(baseImageComparator)
            .map(this::convertToResponseDto)
            .collect(Collectors.toList());
}

ì´ ë°©ì‹ì€ Javaì—ì„œ ì œê³µí•˜ëŠ” Comparator ê¸°ëŠ¥ì„ ì ê·¹ í™œìš©í•˜ëŠ” ë°©ë²•ì¸ë°, í˜¹ì‹œ í•œ ë²ˆ ì ìš©í•´ë³´ê³  ì‹¶ìœ¼ì‹œë©´ ì°¸ê³ í•´ë³´ì„¸ìš”! ğŸš€


---

3ï¸âƒ£ getBaseImageById() - ì‚¬ì „ ì˜¤ë¥˜ ë°©ì§€

ğŸ’¬ "ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ getBaseImageById()ë¡œ ë¶„ë¦¬í•œ ê±´ ì •ë§ ì¢‹ì€ ì„ íƒì´ë„¤ìš”! ì¤‘ë³µëœ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ì„œ ìœ ì§€ë³´ìˆ˜ê°€ í›¨ì”¬ ì‰¬ì›Œì¡Œì–´ìš”. ğŸ‘ ë‹¤ë§Œ, ë§Œì•½ ë²„ì „ì´ "1"ì²˜ëŸ¼ ë‹¨ì¼ ìˆ«ìë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ split("\\.")ì— ëŒ€í•œ ë³´ì™„ì´ í•„ìš”í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ì•„ìš”!"

ğŸ’¡ ì œì•ˆ:
í˜„ì¬ split("\\.")ì„ í˜¸ì¶œí•  ë•Œ, "1" ê°™ì€ ê°’ì´ ë“¤ì–´ì˜¤ë©´ ë°°ì—´ í¬ê¸°ê°€ 1ì´ ë˜ì–´ ArrayIndexOutOfBoundsExceptionì´ ë°œìƒí•  ìˆ˜ ìˆì–´ìš”.
ì´ë¥¼ ë°©ì§€í•˜ë ¤ë©´ ë°°ì—´ í¬ê¸°ë¥¼ ì²´í¬í•˜ê±°ë‚˜, ê¸°ë³¸ê°’ì„ í• ë‹¹í•˜ëŠ” ë°©ì‹ì„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆì–´ìš”.

private int parseVersionPart(String[] versionParts, int index, int defaultValue) {
    return versionParts.length > index ? Integer.parseInt(versionParts[index]) : defaultValue;
}

ê·¸ëŸ¼ compareBaseImages()ì—ì„œëŠ” ì´ë ‡ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”!

String[] version1 = b1.getVersion().split("\\.");
String[] version2 = b2.getVersion().split("\\.");

int major1 = parseVersionPart(version1, 0, 0);
int major2 = parseVersionPart(version2, 0, 0);
if (major1 != major2) {
    return Integer.compare(major2, major1);
}

int minor1 = parseVersionPart(version1, 1, 0);
int minor2 = parseVersionPart(version2, 1, 0);
return Integer.compare(minor2, minor1);

ì´ë ‡ê²Œ í•˜ë©´ "1"ì²˜ëŸ¼ í•œ ìë¦¬ ë²„ì „ì´ ë“¤ì–´ì™€ë„ ì•ˆì „í•˜ê²Œ ë¹„êµí•  ìˆ˜ ìˆì–´ìš”! ğŸ˜Š


---

4ï¸âƒ£ modifyBaseImage() - ë³€ê²½ ê°ì§€ vs ëª…ì‹œì  ì €ì¥

ğŸ’¬ "baseImageRepository.save(baseImage);ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•œ ë¶€ë¶„ì´ ëˆˆì— ë„ë„¤ìš”! Spring JPAì—ì„œëŠ” ì—”í‹°í‹°ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ëŠ” 'ë³€ê²½ ê°ì§€(Dirty Checking)' ê¸°ëŠ¥ì´ ìˆëŠ”ë°, í˜¹ì‹œ ì´ê±¸ í™œìš©í•˜ë©´ ë” ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”!"

ğŸ’¡ ì„¤ëª…:
Spring JPAì˜ ë³€ê²½ ê°ì§€(Dirty Checking) ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ save()ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ìë™ìœ¼ë¡œ ë³€ê²½ ì‚¬í•­ì´ ë°˜ì˜ë¼ìš”.

@Transactional
public BaseImageDTO.Response modifyBaseImage(Long baseImageSeq, BaseImageDTO.Modify reqDto) {
    BaseImage baseImage = getBaseImageById(baseImageSeq);
    baseImage.modify(reqDto);  // ë³€ê²½ ê°ì§€ í™œì„±í™”
    return convertToResponseDto(baseImage);
}

ì´ë ‡ê²Œ í•˜ë©´ save(baseImage) ì—†ì´ë„ modify()ì—ì„œ ë³€ê²½ëœ ë‚´ìš©ì´ ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.
ë‹¤ë§Œ, ë§Œì•½ save()ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•œ ì´ìœ ê°€ ìˆê±°ë‚˜, detach ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ë‹¤ì‹œ persist ì‹œí‚¤ëŠ” ëª©ì ì´ë¼ë©´ ì§€ê¸ˆ ë°©ì‹ë„ ê´œì°®ì•„ìš”!

í˜¹ì‹œ ë³€ê²½ ê°ì§€ì™€ ëª…ì‹œì  ì €ì¥ ë°©ì‹ì— ëŒ€í•´ ë” ê¶ê¸ˆí•˜ì‹œë©´ ì´ ê¸€ì„ ì°¸ê³ í•´ë³´ì„¸ìš”!
ğŸ“Œ Spring JPA ë³€ê²½ ê°ì§€ì™€ save() ì°¨ì´


---

5ï¸âƒ£ convertToResponseDto() - ì„±ëŠ¥ ìµœì í™” ì œì•ˆ

ğŸ’¬ "DTO ë³€í™˜ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡° ë„ˆë¬´ ì¢‹ìŠµë‹ˆë‹¤! ğŸ™Œ í˜¹ì‹œ Jacksonì˜ ObjectMapperë³´ë‹¤ ì„±ëŠ¥ì´ ë” ì¢‹ì€ ModelMapperë‚˜ MapStructë¥¼ ê³ ë ¤í•´ë³¼ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ì•„ìš”!"

ğŸ’¡ ì œì•ˆ:
í˜„ì¬ AppUtil.getMapper().map(baseImage, BaseImageDTO.Response.class);ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ë§Œì•½ Jacksonì˜ ObjectMapperë¼ë©´ ì„±ëŠ¥ì´ ë‹¤ì†Œ ëŠë¦´ ìˆ˜ ìˆì–´ìš”.
ëŒ€ì•ˆìœ¼ë¡œ ModelMapperë‚˜ MapStructë¥¼ ì‚¬ìš©í•˜ë©´ ì†ë„ê°€ ë” ë¹ ë¥´ê³  ì½”ë“œë„ ë” ê¹”ë”í•´ì§‘ë‹ˆë‹¤.

ModelMapper ì ìš© ì˜ˆì‹œ

private final ModelMapper modelMapper = new ModelMapper();

private BaseImageDTO.Response convertToResponseDto(BaseImage baseImage) {
    return modelMapper.map(baseImage, BaseImageDTO.Response.class);
}

MapStruct ì ìš© ì˜ˆì‹œ

@Mapper(componentModel = "spring")
public interface BaseImageMapper {
    BaseImageDTO.Response toResponseDto(BaseImage baseImage);
}

ì´ë ‡ê²Œ í•˜ë©´ ë¶ˆí•„ìš”í•œ ê°ì²´ ë³€í™˜ ê³¼ì •ì´ ì¤„ì–´ë“¤ì–´ì„œ ì„±ëŠ¥ì´ ìµœì í™”ë  ìˆ˜ ìˆì–´ìš”! ğŸš€


---

ë§ˆë¬´ë¦¬ ë©˜íŠ¸

ğŸ”¥ "ì´ë²ˆ ì½”ë“œ ë¦¬íŒ©í† ë§ ì •ë§ ì˜í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‰ ì „ì²´ì ìœ¼ë¡œ ì¤‘ë³µ ì½”ë“œê°€ ì¤„ì–´ë“¤ê³ , ìœ ì§€ë³´ìˆ˜ì„±ì´ ì—„ì²­ ì¢‹ì•„ì¡Œì–´ìš”. ìœ„ì—ì„œ ì œì•ˆë“œë¦° ëª‡ ê°€ì§€ ê°œì„  ì‚¬í•­ë„ í•œ ë²ˆ ê²€í† í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”! ì¢‹ì€ ì½”ë“œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ˜Š"

