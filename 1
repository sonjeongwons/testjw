[root@d2-krw1a-dp-cvc-engine-01 cvc]# docker ps
CONTAINER ID   IMAGE                                                                                                           COMMAND                  CREATED          STATUS          PORTS                                         
                                                                                                                                                                                                                                       
        NAMES
7c048a369926   paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/opentelemetry-collector-contrib:0.118.0   "/otelcol-contrib --…"   41 seconds ago   Up 41 seconds   0.0.0.0:1888->1888/tcp, [::]:1888->1888/tcp, 0
.0.0.0:4317-4318->4317-4318/tcp, [::]:4317-4318->4317-4318/tcp, 0.0.0.0:8888-8889->8888-8889/tcp, [::]:8888-8889->8888-8889/tcp, 0.0.0.0:13133->13133/tcp, [::]:13133->13133/tcp, 0.0.0.0:55679->55679/tcp, [::]:55679->55679/tcp, 5567
8/tcp   cvc-otel-collector-1
313a161822a2   paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/cvc-scanner:latest                        "java -javaagent:/ap…"   42 seconds ago   Up 41 seconds   0.0.0.0:8081->8081/tcp, [::]:8081->8081/tcp   
                                                                                                                                                                                                                                       
        cvc-scanner-1
3105c0b4235e   paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/data-prepper:2.10.1                       "bin/data-prepper"       42 seconds ago   Up 41 seconds   0.0.0.0:4900->4900/tcp, [::]:4900->4900/tcp   
                                                                                                                                                                                                                                       
        data-prepper
[root@d2-krw1a-dp-cvc-engine-01 cvc]# docker logs 7c048a369926 
2025-08-18T03:24:11.895Zinfoservice@v0.118.0/service.go:164Setting up own telemetry...
2025-08-18T03:24:11.895Zwarnservice@v0.118.0/service.go:213service::telemetry::metrics::address is being deprecated in favor of service::telemetry::metrics::readers
2025-08-18T03:24:11.895Zinfotelemetry/metrics.go:70Serving metrics{"address": "0.0.0.0:8888", "metrics level": "Detailed"}
2025-08-18T03:24:11.896Zinfomemorylimiter@v0.118.0/memorylimiter.go:75Memory limiter configured{"kind": "processor", "name": "memory_limiter", "pipeline": "metrics", "limit_mib": 462, "spike_limit_mib": 92,
 "check_interval": 1}
2025-08-18T03:24:11.898Zinfobuilders/builders.go:26Unmaintained component. Actively looking for contributors. Component will become deprecated after 3 months of remaining unmaintained.{"kind": "exporter", "data_type
": "logs", "name": "opensearch/otel"}
2025-08-18T03:24:11.899Zinfoservice@v0.118.0/service.go:230Starting otelcol-contrib...{"Version": "0.118.0", "NumCPU": 4}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:39Starting extensions...
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:42Extension is starting...{"kind": "extension", "name": "file_storage/logs"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:59Extension started.{"kind": "extension", "name": "file_storage/logs"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:42Extension is starting...{"kind": "extension", "name": "basicauth/otel"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:59Extension started.{"kind": "extension", "name": "basicauth/otel"}
2025-08-18T03:24:11.900Zinfointernal/resourcedetection.go:126began detecting resource information{"kind": "processor", "name": "resourcedetection/system", "pipeline": "metrics"}
2025-08-18T03:24:11.900Zinfointernal/resourcedetection.go:140detected resource information{"kind": "processor", "name": "resourcedetection/system", "pipeline": "metrics", "resource": {"host.name":"7c048a369926
","os.type":"linux"}}
2025-08-18T03:24:11.900Zinfootlpreceiver@v0.118.0/otlp.go:112Starting GRPC server{"kind": "receiver", "name": "otlp", "data_type": "logs", "endpoint": "0.0.0.0:4317"}
2025-08-18T03:24:11.900Zinfootlpreceiver@v0.118.0/otlp.go:169Starting HTTP server{"kind": "receiver", "name": "otlp", "data_type": "logs", "endpoint": "0.0.0.0:4318"}
2025-08-18T03:24:11.901Zinfoprometheusreceiver@v0.118.0/metrics_receiver.go:118Starting discovery manager{"kind": "receiver", "name": "prometheus", "data_type": "metrics"}
2025-08-18T03:24:11.901Zinfotargetallocator/manager.go:184Scrape job added{"kind": "receiver", "name": "prometheus", "data_type": "metrics", "jobName": "otel-collector-cvc01"}
2025-08-18T03:24:11.901Zinfoprometheusreceiver@v0.118.0/metrics_receiver.go:187Starting scrape manager{"kind": "receiver", "name": "prometheus", "data_type": "metrics"}
2025-08-18T03:24:11.907Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:11.939Zinfoexporterqueue/persistent_queue.go:151Initializing new persistent queue{"kind": "exporter", "data_type": "traces", "name": "otlp/trace-data-prepper"}
2025-08-18T03:24:11.940Zinfoadapter/receiver.go:41Starting stanza receiver{"kind": "receiver", "name": "filelog", "data_type": "logs"}
2025-08-18T03:24:11.940Zinfoservice@v0.118.0/service.go:253Everything is ready. Begin running and processing data.
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-05-21.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-05-22.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-18.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-19.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-20.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-26.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-18.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-19.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-20.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-21.log"}
2025-08-18T03:24:12.917Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:14.356Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:17.424Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}


[root@d2-krw1a-dp-cvc-engine-01 cvc]# docker logs 7c048a369926
2025-08-18T03:24:11.895Zinfoservice@v0.118.0/service.go:164Setting up own telemetry...
2025-08-18T03:24:11.895Zwarnservice@v0.118.0/service.go:213service::telemetry::metrics::address is being deprecated in favor of service::telemetry::metrics::readers
2025-08-18T03:24:11.895Zinfotelemetry/metrics.go:70Serving metrics{"address": "0.0.0.0:8888", "metrics level": "Detailed"}
2025-08-18T03:24:11.896Zinfomemorylimiter@v0.118.0/memorylimiter.go:75Memory limiter configured{"kind": "processor", "name": "memory_limiter", "pipeline": "metrics", "limit_mib": 462, "spike_limit_mib": 92,
 "check_interval": 1}
2025-08-18T03:24:11.898Zinfobuilders/builders.go:26Unmaintained component. Actively looking for contributors. Component will become deprecated after 3 months of remaining unmaintained.{"kind": "exporter", "data_type
": "logs", "name": "opensearch/otel"}
2025-08-18T03:24:11.899Zinfoservice@v0.118.0/service.go:230Starting otelcol-contrib...{"Version": "0.118.0", "NumCPU": 4}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:39Starting extensions...
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:42Extension is starting...{"kind": "extension", "name": "file_storage/logs"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:59Extension started.{"kind": "extension", "name": "file_storage/logs"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:42Extension is starting...{"kind": "extension", "name": "basicauth/otel"}
2025-08-18T03:24:11.899Zinfoextensions/extensions.go:59Extension started.{"kind": "extension", "name": "basicauth/otel"}
2025-08-18T03:24:11.900Zinfointernal/resourcedetection.go:126began detecting resource information{"kind": "processor", "name": "resourcedetection/system", "pipeline": "metrics"}
2025-08-18T03:24:11.900Zinfointernal/resourcedetection.go:140detected resource information{"kind": "processor", "name": "resourcedetection/system", "pipeline": "metrics", "resource": {"host.name":"7c048a369926
","os.type":"linux"}}
2025-08-18T03:24:11.900Zinfootlpreceiver@v0.118.0/otlp.go:112Starting GRPC server{"kind": "receiver", "name": "otlp", "data_type": "logs", "endpoint": "0.0.0.0:4317"}
2025-08-18T03:24:11.900Zinfootlpreceiver@v0.118.0/otlp.go:169Starting HTTP server{"kind": "receiver", "name": "otlp", "data_type": "logs", "endpoint": "0.0.0.0:4318"}
2025-08-18T03:24:11.901Zinfoprometheusreceiver@v0.118.0/metrics_receiver.go:118Starting discovery manager{"kind": "receiver", "name": "prometheus", "data_type": "metrics"}
2025-08-18T03:24:11.901Zinfotargetallocator/manager.go:184Scrape job added{"kind": "receiver", "name": "prometheus", "data_type": "metrics", "jobName": "otel-collector-cvc01"}
2025-08-18T03:24:11.901Zinfoprometheusreceiver@v0.118.0/metrics_receiver.go:187Starting scrape manager{"kind": "receiver", "name": "prometheus", "data_type": "metrics"}
2025-08-18T03:24:11.907Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:11.939Zinfoexporterqueue/persistent_queue.go:151Initializing new persistent queue{"kind": "exporter", "data_type": "traces", "name": "otlp/trace-data-prepper"}
2025-08-18T03:24:11.940Zinfoadapter/receiver.go:41Starting stanza receiver{"kind": "receiver", "name": "filelog", "data_type": "logs"}
2025-08-18T03:24:11.940Zinfoservice@v0.118.0/service.go:253Everything is ready. Begin running and processing data.
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-05-21.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-05-22.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-18.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-19.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-20.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-06-26.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-18.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-19.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-20.log"}
2025-08-18T03:24:12.142Zinfofileconsumer/file.go:265Started watching file{"kind": "receiver", "name": "filelog", "data_type": "logs", "component": "fileconsumer", "path": "/cvc/log/scanner-2025-07-21.log"}
2025-08-18T03:24:12.917Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:14.356Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}
2025-08-18T03:24:17.424Zwarngrpc@v1.69.4/clientconn.go:1381[core] [Channel #3 SubChannel #4]grpc: addrConn.createTransport failed to connect to {Addr: "data-prepper:21890", ServerName: "data-prepper:21890", }. Err: con
nection error: desc = "transport: Error while dialing: dial tcp 172.18.0.3:21890: connect: connection refused"{"grpc_log": true}




[root@d2-krw1a-dp-cvc-engine-01 cvc]# cat docker-compose.yaml 
services:
  otel-collector:
    user: "0:0"
    image: paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/opentelemetry-collector-contrib:0.118.0
    volumes:
      - /cvc/otelcol-0.118.0.yaml:/etc/otelcol-contrib/config.yaml
      - /var/lib/otelcol/file_storage/gateway:/var/lib/otelcol/file_storage/gateway
      - /cvc/log:/cvc/log
      - /:/hostfs:ro
    environment:
      - AWS_ACCESS_KEY_ID=2ea2be5027cf41789f42f86de3a2ff8d
      - AWS_SECRET_ACCESS_KEY=3ef2f008-6a20-4af2-8d7c-65d2a39320dc
    ports:
      - 1888:1888   # pprof extension
      - 8888:8888   # Prometheus metrics (Collector)
      - 8889:8889   # Prometheus exporter metrics
      - 13133:13133 # health_check
      - 4317:4317   # OTLP gRPC
      - 4318:4318   # OTLP HTTP
      - 55679:55679 # zpages
    extra_hosts:
      - "cortex-paas.kr-west1.dev2.samsungsdscloud.com:198.18.3.136"
      - "opensearch-paas.kr-west1.dev2.samsungsdscloud.com:198.18.3.136"
      - "object-store.private.kr-west1.dev2.samsungsdscloud.com:198.19.126.41"
    depends_on:
      - data-prepper
    restart: unless-stopped

  data-prepper:
    image: paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/data-prepper:2.10.1
    container_name: data-prepper
    # 내부에서 otel-collector가 service name으로 붙으므로 포트 공개는 필수 아님.
    # 외부(호스트)에서 확인/테스트할 수 있도록 관리 포트는 노출.
    ports:
      - "4900:4900"     # Data Prepper Node/HTTP 관리 포트
      # 필요 시 외부에서 바로 보낼 경우만 열 것:
      # - "21890:21890" # OTEL trace source
      # - "21892:21892" # OTEL logs source
    volumes:
      - ./pipelines.yaml:/usr/share/data-prepper/pipelines/pipelines.yaml:ro
      - ./data-prepper-config.yaml:/usr/share/data-prepper/config/data-prepper-config.yaml:ro
    extra_hosts:
      - "opensearch-paas.kr-west1.dev2.samsungsdscloud.com:198.18.3.136"
      # docker run 예시 따라 dashboard 호스트도 추가(필요시)
      - "opensearch-dashboard-paas.kr-west1.dev2.samsungsdscloud.com:198.18.3.136"
    environment: []
    restart: unless-stopped

  scanner:
    image: paascommon-edcnnztb.scr.private.kr-west1.dev2.samsungsdscloud.com/cvc/cvc-scanner:latest
    ports:
      - 8081:8081
    volumes:
      - /cvc/log:/cvc/log
      - /tmp:/tmp
    environment:
      - CVC_KEYSTONE_ID=cvc-service
      - CVC_KEYSTONE_PW=CVCscanner1!
      - IAM_API_ENDPOINT=https://identity-i.kr-west1.dev2.samsungsdscloud.com/v3/auth/tokens?nocatalog=null
    extra_hosts:
      - "iam-i.kr-west1.dev2.samsungsdscloud.com:198.18.2.52"
      - "identity-i.kr-west1.dev2.samsungsdscloud.com:198.18.2.52"
      - "host.docker.internal:host-gateway"
    restart: unless-stopped



    [root@d2-krw1a-dp-cvc-engine-01 cvc]# cat data-prepper-config.yaml 
ssl: false
circuit_breakers:
  heap:
    usage: 0.8gb
    reset: 5s
    check_interval: 1s
peer_forwarder:
  ssl: false
  ssl_insecure_disable_verification: true


  [root@d2-krw1a-dp-cvc-engine-01 cvc]# cat pipelines.yaml 
otel-logs-pipeline:
  buffer:
    bounded_blocking:
      batch_size: 200
      buffer_size: 50000
  processor:
  - date:
      destination: '@timestamp'
      from_time_received: true
  sink:
  - opensearch:
      hosts:
      - https://opensearch-paas.kr-west1.dev2.samsungsdscloud.com
      index: cvc-logs-%{yyyy.MM.dd}
      index_type: custom
      insecure: true
      password: '!CVC_PW123'
      username: cvc_data
  source:
    otel_logs_source:
      authentication:
        unauthenticated:
      port: 21892
      ssl: false
  workers: 3
otel-trace-pipeline:
  buffer:
    bounded_blocking:
      batch_size: 200
      buffer_size: 50000
  delay: "100"
  processor:
  - date:
      destination: '@timestamp'
      from_time_received: true
  sink:
  - pipeline:
      name: raw-trace-pipeline
  - pipeline:
      name: service-map-pipeline
  source:
    otel_trace_source:
      authentication:
        unauthenticated:
      port: 21890
      ssl: false
  workers: 3
raw-trace-pipeline:
  buffer:
    bounded_blocking:
      batch_size: 200
      buffer_size: 50000
  processor:
  - otel_trace_raw:
  - otel_trace_group:
      hosts:
      - https://opensearch-paas.kr-west1.dev2.samsungsdscloud.com
      insecure: true
      password: '!CVC_PW123'
      username: cvc_data
  sink:
  - opensearch:
      hosts:
      - https://opensearch-paas.kr-west1.dev2.samsungsdscloud.com
      index_type: trace-analytics-raw
      insecure: true
      password: '!CVC_PW123'
      username: cvc_data
  source:
    pipeline:
      name: otel-trace-pipeline
  workers: 3
service-map-pipeline:
  buffer:
    bounded_blocking:
      batch_size: 200
      buffer_size: 50000
  delay: "100"
  processor:
  - service_map_stateful:
  sink:
  - opensearch:
      hosts:
      - https://opensearch-paas.kr-west1.dev2.samsungsdscloud.com
      index_type: trace-analytics-service-map
      insecure: true
      password: '!CVC_PW123'
      username: cvc_data
  source:
    pipeline:
      name: otel-trace-pipeline
  workers: 3




[root@d2-krw1a-dp-cvc-engine-01 cvc]# cat otelcol-0.118.0.yaml 
extensions:
  basicauth/otel:
    client_auth:
      username: 'cvc_data' # PARAM : connection.env value update
      password: '!CVC_PW123' # PARAM : connection.env value update
  file_storage/logs:
    create_directory: true
    directory: /var/lib/otelcol/file_storage/gateway
    timeout: 1s
    compaction:
      on_rebound: true
      rebound_needed_threshold_mib: 100
      rebound_trigger_threshold_mib: 10
      check_interval: 5s
      cleanup_on_start: true
      directory: /var/lib/otelcol/file_storage/gateway/tmp

processors:
  batch: {}
  memory_limiter:
    check_interval: 1s
    limit_mib: 462
    limit_percentage: 80
    spike_limit_mib: 92
    spike_limit_percentage: 25
  resourcedetection/system:
    detectors: ["system"]
    system:
      hostname_sources: ["os"]
  resource:
    attributes:
      - key: "lma-tenant"
        value: "cvc"  # PARAM :: vmdb1
        action: insert
      - key: "node"
        value: 'cvc01'
        action: insert
  transform:
    metric_statements:
      - context: datapoint
        statements:
          - set(attributes["host.name"], resource.attributes["host.name"])
          - set(attributes["node.ip"], resource.attributes["node.ip"])
          - set(attributes["process.command"], resource.attributes["process.command"])
          - set(attributes["process.command_line"], resource.attributes["process.command_line"])
          - set(attributes["process.executable.name"], resource.attributes["process.executable.name"])
          - set(attributes["process.executable.path"], resource.attributes["process.executable.path"])
          - set(attributes["process.owner"], resource.attributes["process.owner"])
          - set(attributes["process.parent_pid"], resource.attributes["process.parent_pid"])
          - set(attributes["process.pid"], resource.attributes["process.pid"])

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: '0.0.0.0:4317'
      http:
        endpoint: '0.0.0.0:4318'

  # METRIC Reciever START
  hostmetrics:
    collection_interval: 30s
    root_path: /hostfs
    scrapers:
      cpu:
        metrics:
          system.cpu.logical.count:
            enabled: true
          system.cpu.utilization:
            enabled: true
      memory:
        metrics:
          system.memory.utilization:
            enabled: true
          system.memory.limit:
            enabled: true
      load:
      disk:
      filesystem:
        metrics:
          system.filesystem.utilization:
            enabled: true
      network:
      paging:
      processes:
  prometheus:
    config:
      scrape_configs:
        - job_name: 'otel-collector-cvc01'  # PARAM :: -db1 
          scrape_interval: 30s # default 5s
          static_configs:
            - targets: ['0.0.0.0:8888']
  # METRIC Reciever END

  # LOG Reciever START
  filelog:
    exclude:
    - /var/log/pods/lma_agent-opentelemetry-collector*_*/opentelemetry-collector/*.log
    include:
    - /cvc/log/scanner*.log
    include_file_name: false
    include_file_path: true
    retry_on_failure:
      enabled: true
    start_at: end
  # LOG Reciever END

exporters:
  debug: {}
  # if you need to debug log on pod, use this exporters on piplines
  prometheusremotewrite/otel:
    endpoint: "https://cortex-paas.kr-west1.dev2.samsungsdscloud.com/api/v1/push" # vmware cortex remote write url
    tls:
      insecure: true
    external_labels:
      otel_collector: server
      node_name: 'cvc01'
      node_ip: 'cvc01'
    headers:
      X-Scope-OrgID: 'cvc' # PARAM :: cortex tenant id.
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 24h
    remote_write_queue:
      enabled: true
      queue_size: 10000
    # timeout: 5s
  opensearch/otel:
    # Index Pattern will be : ss4o_{type}-{dataset}-{namespace}
    #dataset: apps
    #namespace: otel
    # If use this, pattern will be {logs_index}
    logs_index: cvc-logs
    http:
      tls:
        insecure_skip_verify: true
      endpoint: https://opensearch-paas.kr-west1.dev2.samsungsdscloud.com
      timeout: 2m
      headers:
        #Content-Type: "application/json"
      auth:
        authenticator: basicauth/otel
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 24h
    sending_queue:
      enabled: true
      num_consumers: 10
      queue_size: 100000
      storage: file_storage/logs
    # timeout: 5s
  awss3/otel:
    s3uploader:
      region: 'kr-west1'
      s3_bucket: 'paas-lma-logs'
      s3_prefix: 'cvc'
      s3_partition: 'hour'
      s3_force_path_style: true
      disable_ssl: true
        endpoint: 'https://object-store.private.kr-west1.dev2.samsungsdscloud.com'
    sending_queue:
      enabled: true
      num_consumers: 1
      queue_size: 100000
      storage: file_storage/logs
  otlp/trace-data-prepper:
    endpoint: data-prepper:21890
    tls:
      insecure: true
      insecure_skip_verify: true
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 24h
    sending_queue:
      enabled: true
      num_consumers: 3
      queue_size: 100000
      storage: file_storage/logs
    timeout: 5s
service:
  extensions:
    - basicauth/otel
    - file_storage/logs
  telemetry:
    metrics:
      address: 0.0.0.0:8888
      level: detailed
  pipelines:
    logs:
      exporters: [opensearch/otel, awss3/otel]
      processors: [resource, transform, memory_limiter, batch]
      receivers: [otlp, filelog]
    metrics:
      exporters: [prometheusremotewrite/otel]
      processors: [resourcedetection/system, resource, transform, memory_limiter, batch]
      receivers: [otlp, hostmetrics, prometheus]
    traces:
      exporters: [otlp/trace-data-prepper]
      processors: [memory_limiter, batch]
      receivers: [otlp]
