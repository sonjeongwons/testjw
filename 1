ì¢‹ì•„, Lambdaâ€“VPC í†µì‹  í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ê°€ì¥ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë§Œë“¤ì–´ì¤„ê²Œ.


---

1. í…ŒìŠ¤íŠ¸ìš© Lambda ì½”ë“œ

Python (lambda_function.py)

import json

def lambda_handler(event, context):
    # ë‹¨ìˆœíˆ EC2ë¡œ í…ŒìŠ¤íŠ¸í•  ê²½ìš°, ì—¬ê¸°ì„œ socket/curl ë“±ìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ ë¨
    return {
        "statusCode": 200,
        "body": json.dumps("Hello from Lambda!")
    }

ë°˜í™˜ í¬ë§·ì„ {statusCode, body} ë¡œ í•˜ë©´ API Gateway ê°™ì€ ì„œë¹„ìŠ¤ì™€ë„ ì‰½ê²Œ ì—°ë™í•  ìˆ˜ ìˆë‹¤.

EC2ì™€ í†µì‹  í…ŒìŠ¤íŠ¸ë¥¼ ì›í•œë‹¤ë©´, ì—¬ê¸°ì„œ socket ë˜ëŠ” requests ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ EC2ì˜ ì‚¬ì„¤ IP:PORT ì— ì ‘ì† ì‹œë„ ì½”ë“œë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.


ì˜ˆì‹œ (EC2 172.31.10.25:3003 TCP ì—°ê²°):

import socket

def lambda_handler(event, context):
    try:
        with socket.create_connection(("172.31.10.25", 3003), timeout=3) as sock:
            msg = b"ping"
            sock.sendall(msg)
            resp = sock.recv(1024)
        return {
            "statusCode": 200,
            "body": f"Connected to EC2. Response: {resp.decode()}"
        }
    except Exception as e:
        return {
            "statusCode": 500,
            "body": f"Connection failed: {str(e)}"
        }


---

2. ë°°í¬ ë°©ë²• (CLI ì˜ˆì‹œ)

1. íŒ¨í‚¤ì§•



zip function.zip lambda_function.py

2. í•¨ìˆ˜ ìƒì„±



aws lambda create-function \
  --function-name MyVpcTestFn \
  --runtime python3.12 \
  --handler lambda_function.lambda_handler \
  --zip-file fileb://function.zip \
  --role arn:aws:iam::<ê³„ì •ID>:role/<LambdaExecutionRole> \
  --vpc-config SubnetIds=subnet-abc123,subnet-def456,SecurityGroupIds=sg-lambda


---

3. í˜¸ì¶œ ë°©ë²•

ë‹¨ìˆœ í˜¸ì¶œ (ì‘ë‹µ í™•ì¸)

aws lambda invoke \
  --function-name MyVpcTestFn \
  --payload '{}' \
  --cli-binary-format raw-in-base64-out \
  out.json

í„°ë¯¸ë„ ì¶œë ¥ì€ StatusCode, ExecutedVersion ê°™ì€ ë©”íƒ€ë°ì´í„°ë§Œ ë³´ì—¬ì¤€ë‹¤.

ì‹¤ì œ body ê°’ì€ out.json íŒŒì¼ì— ì €ì¥ëœë‹¤.


cat out.json
# "Hello from Lambda!"

ë¡œê·¸ê¹Œì§€ ê°™ì´ í™•ì¸

aws lambda invoke \
  --function-name MyVpcTestFn \
  --payload '{}' \
  --cli-binary-format raw-in-base64-out \
  --log-type Tail \
  out.json \
  --query 'LogResult' \
  --output text | base64 --decode


---

4. ë„¤íŠ¸ì›Œí¬ ì ê²€ í¬ì¸íŠ¸

Lambda í•¨ìˆ˜ VPC ì„¤ì •: EC2ì™€ ê°™ì€ VPC, ê°™ì€ AZì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„· ì„ íƒ.

SG: Lambda SG â†’ EC2 SG ë°©í–¥ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í¬íŠ¸(3003 ë“±) ì—´ì–´ë‘ê¸°.

NAT ë¶ˆí•„ìš”: ì‚¬ì„¤ í†µì‹ ë§Œ í•  ê±°ë©´ NATëŠ” í•„ìš” ì—†ë‹¤.



---

ğŸ‘‰ ì´ë ‡ê²Œ í•˜ë©´ aws lambda invoke ê²°ê³¼ë¥¼ out.jsonì—ì„œ í™•ì¸í•˜ë©´ì„œ, EC2ì™€ì˜ ë„¤íŠ¸ì›Œí¬ í†µì‹  ì—¬ë¶€ê¹Œì§€ ë°”ë¡œ ì ê²€í•  ìˆ˜ ìˆì–´.


---

Q1
EC2ì™€ì˜ TCP í†µì‹ ì´ ì‹¤íŒ¨í•  ë•Œ, Lambda ì‹¤í–‰ ë¡œê·¸ì—ì„œ ì–´ë–¤ ë©”ì‹œì§€/ì—ëŸ¬ ìœ í˜•ì„ ë¨¼ì € í™•ì¸í•´ì•¼ í• ê¹Œ?

Q2
ë‚´ê°€ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” í¬íŠ¸ê°€ ì—¬ëŸ¬ ê°œì¼ ë•Œ, Lambda SGì™€ EC2 SG ê·œì¹™ì„ ì–´ë–»ê²Œ êµ¬ì„±í•˜ëŠ” ê²Œ ê°€ì¥ íš¨ìœ¨ì ì¼ê¹Œ?

Q3
CloudWatch Logs ëŒ€ì‹  S3 ê°™ì€ ì €ì¥ì†Œë¡œ Lambda ê²°ê³¼ë¥¼ ë°”ë¡œ ë‚¨ê¸°ê³  ì‹¶ë‹¤ë©´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²Œ ì¢‹ì„ê¹Œ?

